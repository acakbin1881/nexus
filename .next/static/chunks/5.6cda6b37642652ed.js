"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{3005:function(e,t,s){s.r(t),s.d(t,{default:function(){return eC}});var n=s(57437),i=s(2265),a=s(27648),l=s(91804),r=s(40875),o=s(51817),c=s(30401),d=s(78867),x=s(66337),m=s(11239),p=s(96362),u=s(92934),h=s(32489),g=s(28842),f=s(61788),b=s(99397),v=s(18930),j=s(76865),y=s(9089),N=s(33245),z=s(32660),w=s(86595),S=s(98728),C=s(30166);let P=(0,i.memo)(function(e){let{symbol:t="BINANCE:BTCUSDT"}=e;(0,i.useEffect)(()=>{let e=e=>{var t,s;if((null===(t=e.message)||void 0===t?void 0:t.includes("websocket error 1006"))||(null===(s=e.filename)||void 0===s?void 0:s.includes("chrome-extension://")))return e.preventDefault(),e.stopPropagation(),!0},t=e=>{var t,s,n;if((null!==(n=null===(s=e.reason)||void 0===s?void 0:null===(t=s.toString)||void 0===t?void 0:t.call(s))&&void 0!==n?n:"").includes("websocket error 1006")){e.preventDefault();return}};return window.addEventListener("error",e),window.addEventListener("unhandledrejection",t),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",t)}},[]);let s=(0,i.useMemo)(()=>"https://www.tradingview-widget.com/embed-widget/advanced-chart/?locale=en#".concat(encodeURIComponent(JSON.stringify({autosize:!0,symbol:t,interval:"60",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",backgroundColor:"rgba(11, 14, 17, 1)",gridColor:"rgba(30, 35, 40, 0.6)",hide_top_toolbar:!1,hide_legend:!1,allow_symbol_change:!0,save_image:!1,calendar:!1,hide_volume:!1,support_host:"https://www.tradingview.com",toolbar_bg:"#0b0e11",enable_publishing:!1,withdateranges:!0,details:!1,hotlist:!1,show_popup_button:!1,studies:["STD;RSI"],overrides:{"paneProperties.background":"#0b0e11","paneProperties.backgroundType":"solid","mainSeriesProperties.candleStyle.upColor":"#00c076","mainSeriesProperties.candleStyle.downColor":"#ff5353","mainSeriesProperties.candleStyle.wickUpColor":"#00c076","mainSeriesProperties.candleStyle.wickDownColor":"#ff5353","mainSeriesProperties.candleStyle.borderUpColor":"#00c076","mainSeriesProperties.candleStyle.borderDownColor":"#ff5353"}}))),[t]);return(0,n.jsx)("div",{className:"tradingview-widget-container h-full w-full",children:(0,n.jsx)("iframe",{src:s,className:"h-full w-full",style:{border:"none"},sandbox:"allow-scripts allow-same-origin allow-popups",allow:"clipboard-read; clipboard-write",title:"TradingView Chart"})})});var k=s(81113),F=s(36826),E=s(25478),D=s(86804),T=s(47773),U=s(59369),B=s(31014),M=s(19066),L=s(59868),O=s(31758),_=s(1091),A=s(70587),I=s(94355),q=s(84214),Z=s(41662),W=s(97895),R=s(56536),H=s(87807),V=s(83343),G=s(42021);let J="0xb88339CB7199b77E23DB6E890353E22632Ba630f",K="0x6b9e773128f453f5c2c60935ee2de2cbc5390a24",Q=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function balanceOf(address owner) view returns (uint256)"],Y=["function deposit(uint256 amount, uint32 destinationDex)"],X=["function sendRawAction(bytes data) external"],$={"BTC-PERP":0,"ETH-PERP":1,"SOL-PERP":4,"ARB-PERP":17};function ee(e){let t=new D.Z("hyperliquid",999n);return new T.r6(e,t,{staticNetwork:t})}function et(e){let[t,s=""]=e.split("."),n=(s+"00000000").slice(0,8);return((null==t?void 0:t.startsWith("-"))?-1n:1n)*(100000000n*BigInt((null==t?void 0:t.replace("-",""))||"0")+BigInt(n||"0"))}async function es(e,t,s,n,i){let a,l;let r=null!=n?n:await e.getTransactionCount(t,"pending"),o=BigInt(await e.send("eth_gasPrice",[])),c=await e.getNetwork(),d={...s,nonce:r,chainId:c.chainId,type:2,maxFeePerGas:o,maxPriorityFeePerGas:o};for(let t=0;t<3;t++)try{a=await e.estimateGas(d),l=void 0;break}catch(e){l=e,console.warn("[estimateGas] attempt ".concat(t+1,"/3 failed:"),e),await new Promise(e=>setTimeout(e,2e3*(t+1)))}l&&(a=null!=i?i:150000n,console.warn("[estimateGas] All retries failed. Using fallback gasLimit: ".concat(a)));let x={...d,gasLimit:a},{from:m,...p}=x,u=B.Y.from(p),h=U.Pw(u.unsignedSerialized);return{populated:x,unsignedBytes:h,digest:M.w(h),nonce:r}}async function en(e,t){return new L.CH(J,Q,e).allowance(t,K)}async function ei(e,t){return new L.CH(J,Q,e).balanceOf(t)}async function ea(e,t,s,n){return es(e,t,{from:t,to:J,data:new O.vU(Q).encodeFunctionData("approve",[K,s]),value:0n},n)}async function el(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return es(e,t,{from:t,to:K,data:new O.vU(Y).encodeFunctionData("deposit",[s,n]),value:0n},i,150000n)}async function er(e,t,s,n,i,a){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0n,c=arguments.length>9?arguments[9]:void 0,d=et(i),x=et(a),m=function(e,t){let s=new Uint8Array(4);return s[0]=1,s[1]=0,s[2]=e>>8&255,s[3]=255&e,U.Dv(s)+t.slice(2)}(1,_.R.defaultAbiCoder().encode(["uint32","bool","uint64","uint64","bool","uint8","uint128"],[s,n,d,x,l,r,o]));return es(e,t,{from:t,to:"0x3333333333333333333333333333333333333333",data:new O.vU(X).encodeFunctionData("sendRawAction",[m]),value:0n},c)}async function eo(e){return"string"==typeof e?A.K(e):e instanceof Promise?A.K(await e):A.K(await e.getAddress())}async function ec(e,t,s,n,i){let a=M.w(s),l=function(e){if(65===e.length){let t=U.Dv(e.slice(0,32)),s=U.Dv(e.slice(32,64)),n=e[64];return{r:t,s,v:n>=27?n:n+27}}if(64===e.length)return{r:U.Dv(e.slice(0,32)),s:U.Dv(e.slice(32,64)),v:void 0};throw Error("Unexpected signature length: ".concat(e.length))}(n),r=l.r,o=l.s,c=l.v;if(void 0===c){for(let e of[27,28])try{let t=I.R(a,{r,s:o,v:e});if(!i||t.toLowerCase()===i.toLowerCase()){c=e;break}}catch(e){}if(void 0===c)throw Error("Could not determine v from signature")}let d={signature:{r,s:o,v:c}};t.to&&(d.to=await eo(t.to)),t.from&&(d.from=await eo(t.from)),null!=t.nonce&&(d.nonce=t.nonce),null!=t.gasLimit&&(d.gasLimit=t.gasLimit),null!=t.data&&(d.data=t.data),null!=t.value&&(d.value=t.value),null!=t.chainId&&(d.chainId=t.chainId),null!=t.type&&(d.type=t.type),null!=t.maxFeePerGas&&(d.maxFeePerGas=t.maxFeePerGas),null!=t.maxPriorityFeePerGas&&(d.maxPriorityFeePerGas=t.maxPriorityFeePerGas),null!=t.accessList&&(d.accessList=t.accessList);let x=B.Y.from(d);return await e.send("eth_sendRawTransaction",[x.serialized])}async function ed(e){var t,s;let n;let i=new G.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"}),a=new W.W({suiClient:i,config:(0,R.M)("testnet")});await a.initialize();let l=null===(s=(await a.getDWalletInParticularState(e,"Active",{timeout:3e4,interval:3e3})).state)||void 0===s?void 0:null===(t=s.Active)||void 0===t?void 0:t.public_output;if(!l)throw Error("dWallet missing public_output");let r=l instanceof Uint8Array?l:new Uint8Array(l),o=await (0,H.XT)(V.Hy.SECP256K1,r);if(33===o.length){let e=q.E.computePublicKey(o,!1);n=U.Pw(e).slice(1)}else if(65===o.length)n=o.slice(1);else if(64===o.length)n=o;else throw Error("Unexpected public key length: ".concat(o.length));let c=U.Pw(M.w(U.Dv(n))).slice(-20);return A.K(U.Dv(c))}async function ex(e,t){let s=ee(e),n=new L.CH(J,Q,s),[i,a]=await Promise.all([s.getBalance(t),n.balanceOf(t)]);return{hype:Z.dF(i),usdc:Z.bM(a,6)}}async function em(e){var t,s,n;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=await fetch("".concat(i?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clearinghouseState",user:e.toLowerCase()})});if(!a.ok)throw Error("Hyperliquid info API error: ".concat(a.status));let l=await a.json();console.log("[PerpBalance] Raw API response for",e,":",JSON.stringify(l,null,2));let r=null!==(t=null==l?void 0:l.crossMarginSummary)&&void 0!==t?t:null==l?void 0:l.marginSummary,o=null!==(s=null==r?void 0:r.accountValue)&&void 0!==s?s:"0",c=null!==(n=null==r?void 0:r.totalMarginUsed)&&void 0!==n?n:"0",d=(parseFloat(o)-parseFloat(c)).toFixed(2);return console.log("[PerpBalance] Parsed → accountValue:",o,"marginUsed:",c,"withdrawable:",d),{accountValue:o,withdrawable:d,marginUsed:c}}async function ep(e){var t;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=await fetch("".concat(s?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"spotClearinghouseState",user:e})});if(!n.ok)throw Error("Hyperliquid spot API error: ".concat(n.status));let i=await n.json();console.log("[SpotBalance] Raw API response for",e,":",JSON.stringify(i,null,2));let a=(null!==(t=null==i?void 0:i.balances)&&void 0!==t?t:[]).map(e=>{var t,s,n;return{coin:null!==(t=e.coin)&&void 0!==t?t:"",hold:null!==(s=e.hold)&&void 0!==s?s:"0",total:null!==(n=e.total)&&void 0!==n?n:"0"}}),l=0;for(let e of a)"USDC"===e.coin&&(l+=parseFloat(e.total));return{totalUsdValue:l.toFixed(2),balances:a}}async function eu(e){var t;let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=await fetch("".concat(s?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"clearinghouseState",user:e.toLowerCase()})});if(!n.ok)return[];let i=await n.json();return(null!==(t=null==i?void 0:i.assetPositions)&&void 0!==t?t:[]).map(e=>{var t,s,n,i,a,l,r,o,c,d;let x=e.position,m=parseFloat(null!==(n=x.szi)&&void 0!==n?n:"0"),p=parseFloat(null!==(i=x.entryPx)&&void 0!==i?i:"0"),u=parseFloat(null!==(l=null!==(a=null===(t=e.position)||void 0===t?void 0:t.markPx)&&void 0!==a?a:x.entryPx)&&void 0!==l?l:"0"),h=parseFloat(null!==(r=x.unrealizedPnl)&&void 0!==r?r:"0"),g=parseFloat(null!==(o=x.returnOnEquity)&&void 0!==o?o:"0"),f=null!==(c=null===(s=x.leverage)||void 0===s?void 0:s.value)&&void 0!==c?c:"1";return{coin:null!==(d=x.coin)&&void 0!==d?d:"?",side:m>=0?"Long":"Short",size:Math.abs(m).toString(),leverage:"".concat(f,"x"),entryPx:p.toFixed(2),markPx:u.toFixed(2),liquidationPx:x.liquidationPx?parseFloat(x.liquidationPx).toFixed(2):null,unrealizedPnl:h.toFixed(2),returnOnEquity:(100*g).toFixed(2),profitable:h>=0}})}async function eh(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=await fetch("".concat(t?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"openOrders",user:e.toLowerCase()})});if(!s.ok)return[];let n=await s.json();return(null!=n?n:[]).map(e=>{var t,s,n,i,a,l;return{coin:null!==(t=e.coin)&&void 0!==t?t:"?",side:"B"===e.side?"Buy":"Sell",limitPx:null!==(s=e.limitPx)&&void 0!==s?s:"0",sz:null!==(n=e.sz)&&void 0!==n?n:"0",orderType:null!==(i=e.orderType)&&void 0!==i?i:"Limit",timestamp:null!==(a=e.timestamp)&&void 0!==a?a:0,oid:null!==(l=e.oid)&&void 0!==l?l:0}})}async function eg(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=await fetch("".concat(t?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"userFills",user:e.toLowerCase()})});if(!s.ok)return[];let n=await s.json();return(null!=n?n:[]).map(e=>{var t,s,n,i,a,l,r;return{coin:null!==(t=e.coin)&&void 0!==t?t:"?",side:"B"===e.side?"Buy":"Sell",px:null!==(s=e.px)&&void 0!==s?s:"0",sz:null!==(n=e.sz)&&void 0!==n?n:"0",fee:null!==(i=e.fee)&&void 0!==i?i:"0",time:null!==(a=e.time)&&void 0!==a?a:0,hash:null!==(l=e.hash)&&void 0!==l?l:"",crossed:null!==(r=e.crossed)&&void 0!==r&&r}})}async function ef(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=await fetch("".concat(e?"https://api.hyperliquid-testnet.xyz":"https://api.hyperliquid.xyz","/info"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"allMids"})});if(!t.ok)throw Error("Failed to fetch mid prices: ".concat(t.status));return t.json()}var eb=s(69146);let ev=(0,C.default)(()=>s.e(598).then(s.bind(s,37945)),{loadableGenerated:{webpack:()=>[37945]},ssr:!1});function ej(e,t,s){let n=[];for(let i=0;i<t;i++){let t=(i+1)*(2*Math.random()+.5),a="bid"===s?e-t:e+t,l=parseFloat((2.5*Math.random()+.01).toFixed(4)),r=parseFloat((l*(i+1)*.6+l).toFixed(4)),o=Math.min(80*Math.random()+10,95);n.push({price:a.toFixed(2),size:l.toFixed(4),total:r.toFixed(4),depthPercent:o})}return"ask"===s?n.reverse():n}let ey=[{symbol:"BTC-PERP",tv:"BINANCE:BTCUSDT",price:"43,271.50",change:"+2.34%",positive:!0},{symbol:"ETH-PERP",tv:"BINANCE:ETHUSDT",price:"2,284.67",change:"+1.87%",positive:!0},{symbol:"SOL-PERP",tv:"BINANCE:SOLUSDT",price:"98.42",change:"+5.12%",positive:!0},{symbol:"ARB-PERP",tv:"BINANCE:ARBUSDT",price:"1.24",change:"-0.83%",positive:!1}];function eN(e){return e.replace(/,/g,"")}function ez(){let e=(0,i.useMemo)(()=>ej(43271.5,8,"ask"),[]),t=(0,i.useMemo)(()=>ej(43271.5,8,"bid"),[]);return(0,n.jsxs)("div",{className:"text-[11px] font-mono",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 px-4 py-2 text-zinc-500 text-[10px] border-b border-zinc-800/50",children:[(0,n.jsx)("span",{children:"Price (USD)"}),(0,n.jsx)("span",{className:"text-right",children:"Size (BTC)"}),(0,n.jsx)("span",{className:"text-right",children:"Total"})]}),(0,n.jsx)("div",{className:"space-y-0",children:e.map((e,t)=>(0,n.jsxs)("div",{className:"relative grid grid-cols-3 px-4 py-[5px] items-center hover:bg-zinc-800/30 cursor-pointer",children:[(0,n.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-rose-500/[0.06] rounded-l-sm",style:{width:"".concat(e.depthPercent,"%")}}),(0,n.jsx)("span",{className:"relative text-rose-400",children:e.price}),(0,n.jsx)("span",{className:"relative text-zinc-300 text-right",children:e.size}),(0,n.jsx)("span",{className:"relative text-zinc-500 text-right",children:e.total})]},"a-".concat(t)))}),(0,n.jsxs)("div",{className:"flex items-center justify-center py-2.5 border-y border-zinc-800/50 my-0.5",children:[(0,n.jsx)("span",{className:"text-base font-semibold text-zinc-100 font-mono",children:"43,271.50"}),(0,n.jsx)("span",{className:"text-[10px] text-emerald-400 ml-2",children:"+2.34%"})]}),(0,n.jsx)("div",{className:"space-y-0",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"relative grid grid-cols-3 px-4 py-[5px] items-center hover:bg-zinc-800/30 cursor-pointer",children:[(0,n.jsx)("div",{className:"absolute right-0 top-0 bottom-0 bg-emerald-500/[0.06] rounded-l-sm",style:{width:"".concat(e.depthPercent,"%")}}),(0,n.jsx)("span",{className:"relative text-emerald-400",children:e.price}),(0,n.jsx)("span",{className:"relative text-zinc-300 text-right",children:e.size}),(0,n.jsx)("span",{className:"relative text-zinc-500 text-right",children:e.total})]},"b-".concat(t)))})]})}function ew(e){let{selectedMarket:t,livePrice:s,onEvmAddressChange:z}=e,w=(0,F.useCurrentAccount)(),S=(0,F.useDAppKit)(),[C,P]=(0,i.useState)("limit"),[D,T]=(0,i.useState)(10),[U,B]=(0,i.useState)("43,271.50"),[M,O]=(0,i.useState)(""),[_,I]=(0,i.useState)("BTC"),[q,W]=(0,i.useState)(""),[R,H]=(0,i.useState)("0.5"),V=["Hyperliquid","Aster"],[G,K]=(0,i.useState)([{venue:"Hyperliquid",size:""}]);function Q(e,t,s){K(G.map((n,i)=>i===e?{...n,[t]:s}:n))}let{wallets:Y}=(0,k.useRegistryWallets)(null==w?void 0:w.address),X=Y.filter(e=>"evm"===e.chain.toLowerCase()),[et,es]=(0,i.useState)(null),[eo,eu]=(0,i.useState)(!1),[eh,eg]=(0,i.useState)(""),[ef,ev]=(0,i.useState)(!1),[ej,ey]=(0,i.useState)(!1),[ez,ew]=(0,i.useState)(""),[eS,eC]=(0,i.useState)(""),[eP,ek]=(0,i.useState)(null),[eF,eE]=(0,i.useState)(null),[eD,eT]=(0,i.useState)(null),[eU,eB]=(0,i.useState)(!1),[eM,eL]=(0,i.useState)(!1),[eO,e_]=(0,i.useState)(null),[eA,eI]=(0,i.useState)(""),[eq,eZ]=(0,i.useState)(""),[eW,eR]=(0,i.useState)(""),[eH,eV]=(0,i.useState)(!1),[eG,eJ]=(0,i.useState)("10"),[eK,eQ]=(0,i.useState)(!1),[eY,eX]=(0,i.useState)(""),[e$,e0]=(0,i.useState)(""),[e1,e5]=(0,i.useState)(""),[e2,e3]=(0,i.useState)(""),[e4,e6]=(0,i.useState)(""),[e8,e7]=(0,i.useState)(!1),[e9,te]=(0,i.useState)("10"),[tt,ts]=(0,i.useState)(!1),[tn,ti]=(0,i.useState)(""),[ta,tl]=(0,i.useState)(""),[tr,to]=(0,i.useState)(new Set),tc=et?et.presign_ids.filter(e=>!tr.has(e)):[];(0,i.useEffect)(()=>{!et&&X.length>0&&es(X[0])},[X,et]);let td="https://rpc.hyperliquid.xyz/evm",[tx,tm]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!et){eC(""),ek(null),eE(null);return}let e=!1;return tm(!0),eC(""),ek(null),eE(null),eT(null),(async()=>{try{let t=await ed(et.dwallet_addr);if(e)return;eC(t);let s=[];td&&s.push(ex(td,t).then(t=>{e||ek(t)}).catch(()=>{})),s.push(em(t).then(s=>{console.log("[PerpBalance] EVM addr:",t,"→ balance:",s),e||eE(s)}).catch(e=>{console.error("[PerpBalance] Failed to fetch:",e)})),s.push(ep(t).then(s=>{console.log("[SpotBalance] EVM addr:",t,"→ balance:",s),e||eT(s)}).catch(e=>{console.error("[SpotBalance] Failed to fetch:",e)})),await Promise.all(s)}catch(e){}finally{e||tm(!1)}})(),()=>{e=!0}},[et,td]),(0,i.useEffect)(()=>{null==z||z(eS)},[eS,z]),(0,i.useEffect)(()=>{if(!eS)return;let e=setInterval(async()=>{try{if(td){let e=await ex(td,eS);ek(e)}}catch(e){}try{let e=await em(eS);eE(e)}catch(e){}try{let e=await ep(eS);eT(e)}catch(e){}},3e4);return()=>clearInterval(e)},[eS,td]);let tp=(0,i.useCallback)(async()=>{if(et&&eh){ey(!0),ew("");try{if(!eS){let e=await ed(et.dwallet_addr);if(eC(e),td)try{let t=await ex(td,e);ek(t)}catch(e){}}ev(!0)}catch(e){ew((null==e?void 0:e.message)||"Failed to unlock dWallet")}finally{ey(!1)}}},[et,eh,td,eS]),tu=w?e=>S.signAndExecuteTransaction({transaction:e.transaction}):null;async function th(e){if(!et||!w||!tu||!td||!ef)return;let n="market"===C;if(n){if(!M||!s)return}else if(!M||!U)return;eL(!0),e_(e?"buy":"sell"),eI(""),eZ(""),eR("");try{var i;let a,l;if(0===tc.length)throw Error("No presign caps available. Create one from the Portfolio page.");let r=ee(td),o=null!==(i=$[t.symbol])&&void 0!==i?i:0,c=eN(M);if(n){let t=parseFloat(R)/100,n=parseFloat(s);a=(e?n*(1+t):n*(1-t)).toString(),l=3}else a=eN(U),l=2;eI("Building order transaction...");let{populated:d,unsignedBytes:x}=await er(r,eS,o,e,a,c,!1,l),m=await (0,E.uQ)({password:eh,dWalletObjectId:et.dwallet_addr,userPublicOutput:new Uint8Array(et.user_public_output),presignIds:tc,unsignedBytes:x,senderAddress:w.address,signAndExecuteTransaction:tu,onStatus:eI});eI("Broadcasting to Hyperliquid...");let p=await ec(r,d,x,m,eS);eI("Waiting for confirmation...");let u=await r.waitForTransaction(p),h=(null==u?void 0:u.status)===1;to(e=>new Set(e).add(m.usedPresignId)),h?eR("Order placed! Tx: ".concat(p.slice(0,10),"...")):eZ("Transaction failed on-chain")}catch(e){console.error("Order placement failed:",e),eZ((null==e?void 0:e.message)||"Order placement failed")}finally{eL(!1),e_(null),eI("")}}async function tg(){if(et&&w&&tu&&td&&ef&&eG){eQ(!0),eX(""),e0(""),e5("");try{let t=ee(td),s=BigInt(Math.round(1e6*parseFloat(eG)));eX("Checking USDC balance...");let n=await ei(t,eS);if(n<s){let e=Number(n)/1e6,t=Number(s)/1e6;throw Error("Insufficient USDC on HyperEVM. Have ".concat(e," USDC, need ").concat(t," USDC. ")+"Bridge more USDC to your dWallet address on HyperEVM first.")}eX("Checking USDC allowance...");let i=await en(t,eS)<s,a=null,l=null;if(i){if(tc.length<2)throw Error("Deposit requires at least 2 presign caps (1 for approve, 1 for deposit).");eX("Building approve transaction...");let e=await ea(t,eS,s);eX("Signing approve via dWallet...");let n=await (0,E.uQ)({password:eh,dWalletObjectId:et.dwallet_addr,userPublicOutput:new Uint8Array(et.user_public_output),presignIds:tc,unsignedBytes:e.unsignedBytes,senderAddress:w.address,signAndExecuteTransaction:tu,onStatus:eX});eX("Broadcasting approve...");let i=await ec(t,e.populated,e.unsignedBytes,n,eS);eX("Waiting for approve confirmation...");let r=await t.waitForTransaction(i);if((null==r?void 0:r.status)!==1)throw Error("Approve transaction failed on-chain");a=n.usedPresignId,l=e.nonce,to(e=>new Set(e).add(a))}else eX("Allowance sufficient, skipping approve.");let r=a?tc.filter(e=>e!==a):tc;if(0===r.length)throw Error("No presign caps remaining for deposit. Create more presigns.");eX("Building deposit transaction...");let o=null!=l?l+1:void 0,c=await el(t,eS,s,0,o);eX("Signing deposit via dWallet...");let d=await (0,E.uQ)({password:eh,dWalletObjectId:et.dwallet_addr,userPublicOutput:new Uint8Array(et.user_public_output),presignIds:r,unsignedBytes:c.unsignedBytes,senderAddress:w.address,signAndExecuteTransaction:tu,onStatus:eX});eX("Broadcasting deposit...");let x=await ec(t,c.populated,c.unsignedBytes,d,eS);eX("Waiting for deposit confirmation...");let m=await t.waitForTransaction(x);if(to(e=>new Set(e).add(d.usedPresignId)),(null==m?void 0:m.status)===1){if(e5("Deposited ".concat(eG," USDC! Tx: ").concat(x.slice(0,10),"...")),eS){var e;try{let e=await ex(td,eS);ek(e)}catch(e){}eX("Waiting for HyperCore bridge settlement...");let t=parseFloat(null!==(e=null==eF?void 0:eF.accountValue)&&void 0!==e?e:"0"),s=!1;for(let e=0;e<12;e++){await new Promise(e=>setTimeout(e,1e4));try{let e=await em(eS);if(eE(e),parseFloat(e.accountValue)>t){s=!0;break}}catch(e){}eX("Waiting for HyperCore bridge settlement... (".concat((e+1)*10,"s)"))}try{let e=await ep(eS);eT(e)}catch(e){}s||e5("Deposit tx confirmed! Bridge settlement may take a few more minutes. Tx: ".concat(x.slice(0,10),"..."))}}else e0("Deposit transaction failed on-chain")}catch(e){console.error("Deposit failed:",e),e0((null==e?void 0:e.message)||"Deposit failed")}finally{eQ(!1),eX("")}}}let tf={chainId:"0x3E7",chainName:"Hyperliquid",rpcUrls:["https://rpc.hyperliquid.xyz/evm"],nativeCurrency:{name:"HYPE",symbol:"HYPE",decimals:18},blockExplorerUrls:["https://purrsec.com"]};async function tb(){if(!window.ethereum){ti("MetaMask not detected. Please install MetaMask.");return}e7(!0),ti("");try{let e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e[0])throw Error("No accounts returned");let t=A.K(e[0]);e3(t);try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:tf.chainId}]})}catch(e){if(4902===e.code)await window.ethereum.request({method:"wallet_addEthereumChain",params:[tf]});else throw e}let s=new eb.Q(window.ethereum),n=new L.CH(J,["function balanceOf(address) view returns (uint256)"],s),i=await n.balanceOf(t);e6(Z.bM(i,6))}catch(e){console.error("MetaMask connect error:",e),ti((null==e?void 0:e.message)||"Failed to connect MetaMask")}finally{e7(!1)}}async function tv(){if(e2&&eS&&e9){ts(!0),ti(""),tl("");try{let e=new eb.Q(window.ethereum),t=await e.getSigner(),s=new L.CH(J,["function transfer(address to, uint256 amount) returns (bool)"],t),n=BigInt(Math.round(1e6*parseFloat(e9))),i=await s.transfer(eS,n),a=await i.wait();if((null==a?void 0:a.status)===1){tl("Sent ".concat(e9," USDC to dWallet! Tx: ").concat(i.hash.slice(0,10),"..."));let t=new L.CH(J,["function balanceOf(address) view returns (uint256)"],e),s=await t.balanceOf(e2);if(e6(Z.bM(s,6)),td&&eS)try{let e=await ex(td,eS);ek(e)}catch(e){}}else ti("Transfer transaction failed on-chain")}catch(e){console.error("MetaMask deposit error:",e),ti((null==e?void 0:e.message)||"MetaMask deposit failed")}finally{ts(!1)}}}return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-3 pb-3 border-b border-zinc-800",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.Z,{size:14,className:"text-indigo-400"}),(0,n.jsx)("span",{className:"text-[12px] font-medium text-zinc-300",children:"dWallet"}),ef&&(0,n.jsxs)("span",{className:"ml-auto flex items-center gap-1 text-[10px] text-emerald-400",children:[(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400"}),"Connected"]})]}),X.length>0?(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("button",{onClick:()=>eu(!eo),className:"w-full flex items-center justify-between px-3 py-2 bg-zinc-800/60 border border-zinc-700/50 rounded-lg hover:border-zinc-600 transition-colors text-[12px]",children:[(0,n.jsx)("span",{className:"text-zinc-300 font-mono",children:et?"".concat(et.label," (").concat(et.dwallet_addr.slice(0,6),"...").concat(et.dwallet_addr.slice(-4),")"):"Select dWallet"}),(0,n.jsx)(r.Z,{size:12,className:"text-zinc-500 transition-transform ".concat(eo?"rotate-180":"")})]}),eo&&(0,n.jsx)("div",{className:"absolute z-50 top-full left-0 mt-1 w-full bg-zinc-900 border border-zinc-800 rounded-lg shadow-lg overflow-hidden",children:X.map(e=>(0,n.jsxs)("button",{onClick:()=>{es(e),eu(!1),ev(!1),eC(""),ek(null)},className:"w-full text-left px-3 py-2 hover:bg-zinc-800/50 text-[11px] ".concat((null==et?void 0:et.dwallet_addr)===e.dwallet_addr?"bg-indigo-500/[0.06]":""),children:[(0,n.jsx)("div",{className:"text-zinc-300 font-medium",children:e.label}),(0,n.jsxs)("div",{className:"text-zinc-600 font-mono text-[10px]",children:[e.dwallet_addr.slice(0,8),"...",e.dwallet_addr.slice(-6)]}),(0,n.jsxs)("div",{className:"text-zinc-500 text-[10px]",children:[e.presign_ids.length," presign",1!==e.presign_ids.length?"s":""]})]},e.dwallet_addr))})]}):(0,n.jsx)("div",{className:"px-3 py-2 bg-zinc-800/40 rounded-lg",children:(0,n.jsxs)("p",{className:"text-[11px] text-zinc-500",children:["No EVM dWallets found."," ",(0,n.jsx)(a.default,{href:"/portfolio",className:"text-indigo-400 hover:text-indigo-300",children:"Create one"})]})}),et&&(0,n.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-zinc-800/40 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase tracking-wide",children:"EVM Address"}),tx?(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsx)(o.Z,{size:10,className:"animate-spin text-zinc-500"}),(0,n.jsx)("span",{className:"text-[11px] text-zinc-500",children:"Deriving..."})]}):eS?(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsxs)("span",{className:"text-[11px] font-mono text-zinc-300",children:[eS.slice(0,6),"...",eS.slice(-4)]}),(0,n.jsx)("button",{onClick:function(){eS&&navigator.clipboard.writeText(eS).then(()=>{eB(!0),setTimeout(()=>eB(!1),2e3)})},className:"p-0.5 rounded text-zinc-500 hover:text-zinc-300 transition-colors",title:"Copy EVM address",children:eU?(0,n.jsx)(c.Z,{size:11,className:"text-emerald-400"}):(0,n.jsx)(d.Z,{size:11})})]}):(0,n.jsx)("span",{className:"text-[11px] text-zinc-600",children:"Not active yet"})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Wallet USDC"}),(0,n.jsx)("div",{className:"text-[11px] font-mono text-zinc-200",children:eP?parseFloat(eP.usdc).toLocaleString(void 0,{maximumFractionDigits:2}):tx?"...":"--"})]})]}),et&&!ef&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex-1 flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-lg h-9",children:[(0,n.jsx)(x.Z,{size:12,className:"text-zinc-600 ml-3"}),(0,n.jsx)("input",{type:"password",value:eh,onChange:e=>{eg(e.target.value),ew("")},placeholder:"dWallet password",className:"flex-1 bg-transparent px-2 text-zinc-100 text-[12px] outline-none placeholder-zinc-700",onKeyDown:e=>"Enter"===e.key&&tp()})]}),(0,n.jsxs)("button",{onClick:tp,disabled:!eh||ej,className:"px-3 h-9 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-[11px] font-medium rounded-lg transition-colors flex items-center gap-1.5",children:[ej?(0,n.jsx)(o.Z,{size:12,className:"animate-spin"}):(0,n.jsx)(m.Z,{size:12}),"Unlock"]})]}),ez&&(0,n.jsx)("p",{className:"text-[11px] text-red-400",children:ez})]}),ef&&eS&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"space-y-1.5",children:[(0,n.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase tracking-wide",children:"HyperEVM → HyperCore"}),(0,n.jsxs)("div",{className:"flex gap-1.5",children:[(0,n.jsx)("input",{type:"text",value:eG,onChange:e=>eJ(e.target.value),disabled:eK,className:"flex-1 min-w-0 px-2.5 py-1.5 bg-zinc-800 border border-zinc-700 rounded-lg text-[11px] text-zinc-100 font-mono placeholder-zinc-600 focus:outline-none focus:ring-0 focus:border-zinc-500 disabled:opacity-50",placeholder:"USDC amount"}),(0,n.jsxs)("button",{onClick:tg,disabled:!eG||eK||0===tc.length,className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-[11px] font-medium rounded-lg transition-colors whitespace-nowrap",children:[eK?(0,n.jsx)(o.Z,{size:12,className:"animate-spin"}):(0,n.jsx)(p.Z,{size:12}),eK?"Depositing...":"Deposit"]})]}),eY&&eK&&(0,n.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-zinc-800/50 rounded-lg",children:[(0,n.jsx)(o.Z,{size:10,className:"animate-spin text-indigo-400"}),(0,n.jsx)("span",{className:"text-[10px] text-zinc-400",children:eY})]}),e$&&(0,n.jsx)("div",{className:"px-2.5 py-1.5 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[10px] text-red-400",children:e$})}),e1&&(0,n.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[(0,n.jsx)(u.Z,{size:10,className:"text-emerald-400"}),(0,n.jsx)("p",{className:"text-[10px] text-emerald-400",children:e1})]})]}),(0,n.jsxs)("button",{onClick:()=>{eV(!0),ti(""),tl("")},className:"w-full flex items-center justify-center gap-2 px-3 py-1.5 bg-zinc-800/60 border border-zinc-700/50 rounded-lg hover:bg-zinc-800 hover:border-zinc-600 transition-colors text-[11px] text-zinc-400 hover:text-zinc-300",children:[(0,n.jsx)(l.Z,{size:12}),"Fund from MetaMask"]}),(0,n.jsxs)("div",{className:"text-[10px] text-zinc-600 text-center",children:[tc.length," presign",1!==tc.length?"s":""," available"]})]})]}),eH&&(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:()=>!tt&&eV(!1),children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-sm mx-4 bg-zinc-900 border border-zinc-800 rounded-2xl shadow-2xl p-6",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-zinc-100",children:"Fund from MetaMask"}),(0,n.jsx)("button",{onClick:()=>!tt&&eV(!1),className:"p-1 rounded-lg text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800 transition-colors",children:(0,n.jsx)(h.Z,{size:16})})]}),(0,n.jsx)("div",{className:"space-y-3",children:e2?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"px-3 py-2 bg-zinc-800 rounded-lg space-y-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-[11px] text-zinc-500",children:"MetaMask"}),(0,n.jsxs)("span",{className:"text-[11px] text-zinc-300 font-mono",children:[e2.slice(0,6),"...",e2.slice(-4)]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-[11px] text-zinc-500",children:"USDC Balance"}),(0,n.jsx)("span",{className:"text-[11px] text-zinc-300 font-mono",children:e4||"—"})]})]}),eS&&(0,n.jsx)("div",{className:"px-3 py-2 bg-zinc-800/50 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-[11px] text-zinc-500",children:"Sending to (dWallet)"}),(0,n.jsxs)("span",{className:"text-[11px] text-zinc-300 font-mono",children:[eS.slice(0,6),"...",eS.slice(-4)]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-[11px] text-zinc-500 uppercase tracking-wide mb-1.5 block",children:"Amount (USDC)"}),(0,n.jsx)("input",{type:"text",value:e9,onChange:e=>te(e.target.value),disabled:tt,className:"w-full px-3 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-sm text-zinc-100 font-mono placeholder-zinc-600 focus:outline-none focus:ring-0 focus:border-zinc-500 disabled:opacity-50",placeholder:"10.00"})]}),!eS&&(0,n.jsx)("div",{className:"px-3 py-2 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[11px] text-yellow-400",children:"Unlock your dWallet first to get the destination EVM address."})}),tn&&(0,n.jsx)("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[11px] text-red-400",children:tn})}),ta&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[(0,n.jsx)(u.Z,{size:14,className:"text-emerald-400"}),(0,n.jsx)("p",{className:"text-[11px] text-emerald-400",children:ta})]}),(0,n.jsx)("button",{onClick:tv,disabled:!e9||tt||!eS,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-orange-600 hover:bg-orange-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:tt?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{size:16,className:"animate-spin"}),"Sending..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Z,{size:16}),"Send ",e9," USDC to dWallet"]})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-[11px] text-zinc-500",children:"Connect MetaMask to transfer USDC to your dWallet's EVM address on HyperEVM."}),(0,n.jsx)("button",{onClick:tb,disabled:e8,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-orange-600 hover:bg-orange-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:e8?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{size:16,className:"animate-spin"}),"Connecting..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Z,{size:16}),"Connect MetaMask"]})})]})})]})]}),(0,n.jsx)("div",{className:"flex bg-zinc-800/50 rounded-lg p-1",children:["limit","market"].map(e=>(0,n.jsx)("button",{onClick:()=>P(e),className:"flex-1 py-2 text-[12px] font-medium tracking-wide uppercase rounded-md transition-all ".concat(C===e?"bg-zinc-700 text-zinc-100 shadow-sm":"text-zinc-500 hover:text-zinc-300"),children:e},e))}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-1.5",children:[(0,n.jsxs)("div",{className:"flex flex-col px-3 py-2 bg-zinc-800/30 rounded-lg",children:[(0,n.jsx)("span",{className:"text-[10px] text-zinc-500",children:"Perps"}),(0,n.jsx)("span",{className:"text-[12px] font-mono text-emerald-300 font-medium",children:eF?"".concat(parseFloat(eF.accountValue).toLocaleString(void 0,{maximumFractionDigits:2})):"--"})]}),(0,n.jsxs)("div",{className:"flex flex-col px-3 py-2 bg-zinc-800/30 rounded-lg",children:[(0,n.jsx)("span",{className:"text-[10px] text-zinc-500",children:"Spot"}),(0,n.jsx)("span",{className:"text-[12px] font-mono text-indigo-300 font-medium",children:eD?"".concat(parseFloat(eD.totalUsdValue).toLocaleString(void 0,{maximumFractionDigits:2})):"--"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2.5",children:[(0,n.jsx)("span",{className:"text-zinc-400 text-[12px]",children:"Leverage"}),(0,n.jsxs)("span",{className:"font-mono text-zinc-100 text-[12px] font-semibold bg-zinc-800 px-2.5 py-1 rounded-md",children:[D,"x"]})]}),(0,n.jsxs)("div",{className:"relative h-7 flex items-center",children:[(0,n.jsx)("div",{className:"absolute left-0 right-0 h-1.5 bg-zinc-800 rounded-full"}),(0,n.jsx)("div",{className:"absolute left-0 h-1.5 bg-indigo-600 rounded-full transition-all",style:{width:"".concat((D-1)/19*100,"%")}}),(0,n.jsx)("input",{type:"range",min:"1",max:"20",value:D,onChange:e=>T(Number(e.target.value)),className:"absolute w-full h-7 opacity-0 cursor-pointer","aria-label":"Leverage"}),(0,n.jsx)("div",{className:"absolute w-4 h-4 rounded-full bg-indigo-500 border-2 border-zinc-900 pointer-events-none transition-all",style:{left:"calc(".concat((D-1)/19*100,"% - 8px)")}})]}),(0,n.jsx)("div",{className:"flex justify-between mt-1.5",children:[1,2,5,10,20].map(e=>(0,n.jsxs)("button",{onClick:()=>T(e),className:"text-[10px] font-mono transition-colors ".concat(D===e?"text-indigo-400":"text-zinc-600 hover:text-zinc-400"),children:[e,"x"]},e))})]}),"limit"===C?(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-zinc-400 text-[12px] mb-1.5 block",children:"Price"}),(0,n.jsxs)("div",{className:"flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-lg h-10 overflow-hidden",children:[(0,n.jsx)("button",{className:"px-3 text-zinc-500 hover:text-zinc-300 transition-colors h-full text-lg","aria-label":"Decrease price",children:"-"}),(0,n.jsx)("input",{type:"text",value:U,onChange:e=>B(e.target.value),className:"flex-1 bg-transparent text-center text-zinc-100 font-mono text-[13px] outline-none","aria-label":"Order price"}),(0,n.jsx)("button",{className:"px-3 text-zinc-500 hover:text-zinc-300 transition-colors h-full text-lg","aria-label":"Increase price",children:"+"}),(0,n.jsx)("span",{className:"text-zinc-500 text-[10px] pr-3 font-mono",children:"USD"})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-zinc-400 text-[12px] mb-1.5 block",children:"Market Price"}),(0,n.jsxs)("div",{className:"flex items-center justify-between bg-zinc-800/60 border border-zinc-700/50 rounded-lg h-10 px-3",children:[(0,n.jsx)("span",{className:"text-zinc-100 font-mono text-[13px]",children:s?parseFloat(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"Loading..."}),(0,n.jsx)("span",{className:"text-zinc-500 text-[10px] font-mono",children:"USD (live)"})]}),(0,n.jsxs)("div",{className:"text-[10px] text-zinc-600 mt-1",children:["Executes at market price \xb1 ",R,"% slippage"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,n.jsx)("label",{className:"text-zinc-400 text-[12px]",children:"Size"}),(0,n.jsxs)("button",{onClick:()=>I("BTC"===_?"USD":"BTC"),className:"flex items-center gap-1 text-[10px] text-zinc-500 hover:text-indigo-400 transition-colors",children:[(0,n.jsx)(g.Z,{size:10}),_]})]}),(0,n.jsxs)("div",{className:"flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-lg h-10",children:[(0,n.jsx)("input",{type:"text",value:M,onChange:e=>O(e.target.value),placeholder:"0.00",className:"flex-1 bg-transparent px-3 text-zinc-100 font-mono text-[13px] outline-none placeholder-zinc-700","aria-label":"Order size"}),(0,n.jsx)("button",{className:"text-[10px] text-indigo-400 hover:text-indigo-300 px-2 font-medium transition-colors",children:"MAX"}),(0,n.jsx)("span",{className:"text-zinc-500 text-[10px] pr-3 font-mono",children:_})]}),(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5 mt-2",children:["10%","25%","50%","100%"].map(e=>(0,n.jsx)("button",{className:"py-1.5 text-[10px] font-mono text-zinc-500 bg-zinc-800/40 border border-zinc-700/30 rounded-md hover:text-zinc-300 hover:border-zinc-600 transition-colors",children:e},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsxs)("label",{className:"flex items-center gap-1.5 text-zinc-400 text-[12px]",children:[(0,n.jsx)(f.Z,{size:11,className:"text-indigo-400"}),"Route Legs"]}),G.length<V.length&&(0,n.jsxs)("button",{onClick:function(){if(G.length>=V.length)return;let e=new Set(G.map(e=>e.venue)),t=V.find(t=>!e.has(t));t&&K([...G,{venue:t,size:""}])},className:"flex items-center gap-1 text-[10px] text-indigo-400 hover:text-indigo-300 transition-colors",children:[(0,n.jsx)(b.Z,{size:10}),"Add Venue"]})]}),(0,n.jsx)("div",{className:"space-y-2",children:G.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2.5 bg-zinc-800/40 border border-zinc-700/30 rounded-lg",children:[(0,n.jsx)("select",{value:e.venue,onChange:e=>Q(t,"venue",e.target.value),className:"bg-zinc-800 border border-zinc-700/50 rounded-md px-2 py-1.5 text-[11px] text-zinc-200 font-medium focus:outline-none focus:ring-0 focus:border-zinc-500 appearance-none cursor-pointer",children:V.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsxs)("div",{className:"flex-1 flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-md h-8",children:[(0,n.jsx)("input",{type:"text",value:e.size,onChange:e=>Q(t,"size",e.target.value),placeholder:"Size",className:"flex-1 bg-transparent px-2 text-zinc-100 font-mono text-[11px] outline-none focus:ring-0 placeholder-zinc-700"}),(0,n.jsx)("span",{className:"text-zinc-600 text-[10px] pr-2 font-mono",children:_})]}),G.length>1&&(0,n.jsx)("button",{onClick:()=>{G.length<=1||K(G.filter((e,s)=>s!==t))},className:"p-1 rounded text-zinc-600 hover:text-rose-400 transition-colors","aria-label":"Remove leg",children:(0,n.jsx)(v.Z,{size:12})})]},t))}),G.length>1&&(0,n.jsxs)("div",{className:"flex items-center gap-1.5 mt-1.5 px-1",children:[(0,n.jsx)("div",{className:"h-1 w-1 rounded-full bg-indigo-500"}),(0,n.jsxs)("span",{className:"text-[10px] text-zinc-600",children:["Order will be split across ",G.length," venues"]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"flex items-center gap-1.5 text-zinc-400 text-[12px] mb-1.5",children:[(0,n.jsx)(j.Z,{size:11,className:"text-zinc-500"}),"Trigger Price"]}),(0,n.jsxs)("div",{className:"flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-lg h-9",children:[(0,n.jsx)("input",{type:"text",value:q,onChange:e=>W(e.target.value),placeholder:"Stop / Conditional",className:"flex-1 bg-transparent px-3 text-zinc-100 font-mono text-[12px] outline-none placeholder-zinc-700","aria-label":"Trigger price"}),(0,n.jsx)("span",{className:"text-zinc-500 text-[10px] pr-3 font-mono",children:"USD"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"flex items-center gap-1.5 text-zinc-400 text-[12px] mb-1.5",children:[(0,n.jsx)(y.Z,{size:11,className:"text-zinc-500"}),"Slippage Tolerance"]}),(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[["0.1","0.5","1.0"].map(e=>(0,n.jsxs)("button",{onClick:()=>H(e),className:"flex-1 py-1.5 text-[11px] font-mono rounded-md border transition-colors ".concat(R===e?"border-indigo-500/40 bg-indigo-500/10 text-indigo-400":"border-zinc-700/50 text-zinc-500 hover:text-zinc-300 hover:border-zinc-600"),children:[e,"%"]},e)),(0,n.jsxs)("div",{className:"flex-1 flex items-center bg-zinc-800/60 border border-zinc-700/50 rounded-md h-[34px]",children:[(0,n.jsx)("input",{type:"text",value:R,onChange:e=>H(e.target.value),className:"w-full bg-transparent px-2 text-zinc-100 font-mono text-[11px] outline-none text-center","aria-label":"Custom slippage"}),(0,n.jsx)("span",{className:"text-zinc-500 text-[10px] pr-2",children:"%"})]})]})]}),(0,n.jsx)("div",{className:"border-t border-zinc-800"}),(0,n.jsx)("div",{className:"space-y-2 text-[11px]",children:[{label:"Perps Balance",value:eF?"".concat(parseFloat(eF.accountValue).toLocaleString(void 0,{maximumFractionDigits:2})," USDC"):"-- USDC"},{label:"Spot Balance",value:eD?"".concat(parseFloat(eD.totalUsdValue).toLocaleString(void 0,{maximumFractionDigits:2})," USDC"):"-- USDC"},{label:"Order Value",value:M?"".concat((parseFloat(eN(M)||"0")*parseFloat("market"===C?s||"0":eN(U)||"0")).toLocaleString(void 0,{maximumFractionDigits:2})," USD"):"-- USD"},{label:"Est. Liq. Price",value:"--"},{label:"Fee (Maker / Taker)",value:"0.02% / 0.05%"}].map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("span",{className:"text-zinc-500 flex items-center gap-1",children:[e.label,(0,n.jsx)(N.Z,{size:10,className:"text-zinc-600"})]}),(0,n.jsx)("span",{className:"font-mono text-zinc-300",children:e.value})]},e.label))}),eA&&eM&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-zinc-800/50 rounded-lg",children:[(0,n.jsx)(o.Z,{size:14,className:"animate-spin text-indigo-400"}),(0,n.jsx)("span",{className:"text-[11px] text-zinc-400",children:eA})]}),eq&&(0,n.jsx)("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[11px] text-red-400",children:eq})}),eW&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[(0,n.jsx)(u.Z,{size:14,className:"text-emerald-400"}),(0,n.jsx)("p",{className:"text-[11px] text-emerald-400",children:eW})]}),!ef&&et&&(0,n.jsx)("div",{className:"text-[10px] text-amber-400/80 text-center",children:"Unlock your dWallet to trade"}),ef&&0===tc.length&&(0,n.jsx)("div",{className:"text-[10px] text-amber-400/80 text-center",children:"No presign caps available — create more from the Portfolio page"}),ef&&tc.length>0&&!M&&(0,n.jsx)("div",{className:"text-[10px] text-zinc-500 text-center",children:"Enter a size to place an order"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2.5 pt-1",children:[(0,n.jsxs)("button",{onClick:()=>th(!0),disabled:!ef||eM||!M||("limit"===C?!U:!s)||0===tc.length,className:"h-11 rounded-lg bg-emerald-600 hover:bg-emerald-500 disabled:opacity-40 disabled:cursor-not-allowed text-white font-semibold text-[13px] tracking-wide transition-colors flex items-center justify-center gap-2",children:["buy"===eO?(0,n.jsx)(o.Z,{size:14,className:"animate-spin"}):null,"Buy / Long"]}),(0,n.jsxs)("button",{onClick:()=>th(!1),disabled:!ef||eM||!M||("limit"===C?!U:!s)||0===tc.length,className:"h-11 rounded-lg bg-rose-600 hover:bg-rose-500 disabled:opacity-40 disabled:cursor-not-allowed text-white font-semibold text-[13px] tracking-wide transition-colors flex items-center justify-center gap-2",children:["sell"===eO?(0,n.jsx)(o.Z,{size:14,className:"animate-spin"}):null,"Sell / Short"]})]}),(0,n.jsxs)("div",{className:"text-[10px] text-zinc-600 flex items-center justify-between",children:[(0,n.jsxs)("span",{children:["Margin Mode: ",(0,n.jsx)("span",{className:"text-zinc-400",children:"Cross"})]}),(0,n.jsx)("button",{className:"text-indigo-400 hover:text-indigo-300 transition-colors",children:"Switch"})]})]})}function eS(e){let{evmAddress:t}=e,[s,a]=(0,i.useState)("positions"),[l,r]=(0,i.useState)([]),[c,d]=(0,i.useState)([]),[x,m]=(0,i.useState)([]),[p,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!t){r([]),d([]),m([]);return}let e=!1,s=async()=>{u(!0);try{let[s,n,i]=await Promise.all([eu(t),eh(t),eg(t)]);e||(r(s),d(n),m(i))}catch(e){}e||u(!1)};s();let n=setInterval(s,15e3);return()=>{e=!0,clearInterval(n)}},[t]);let h=e=>e?new Date(e).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-0 border-b border-zinc-800/50 px-2",children:[[{key:"positions",label:"Positions (".concat(l.length,")")},{key:"orders",label:"Open Orders (".concat(c.length,")")},{key:"history",label:"History (".concat(x.length,")")}].map(e=>(0,n.jsx)("button",{onClick:()=>a(e.key),className:"px-4 py-3 text-[12px] tracking-wide border-b-2 transition-colors ".concat(s===e.key?"border-indigo-500 text-zinc-100 font-medium":"border-transparent text-zinc-500 hover:text-zinc-300"),children:e.label},e.key)),p&&(0,n.jsx)(o.Z,{size:12,className:"animate-spin text-zinc-500 ml-2"})]}),(0,n.jsxs)("div",{className:"overflow-x-auto",children:["positions"===s&&(0===l.length?(0,n.jsx)("div",{className:"flex items-center justify-center py-12 text-zinc-600 text-[12px]",children:t?"No open positions":"Connect and select a dWallet to view positions"}):(0,n.jsxs)("table",{className:"w-full text-[11px] font-mono",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-zinc-500 text-left",children:[(0,n.jsx)("th",{className:"pl-4 py-2.5 font-medium",children:"Symbol"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Side"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Size"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Leverage"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Entry"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Mark"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Liq. Price"}),(0,n.jsx)("th",{className:"py-2.5 font-medium text-right pr-4",children:"PnL (ROE%)"})]})}),(0,n.jsx)("tbody",{children:l.map(e=>(0,n.jsxs)("tr",{className:"border-t border-zinc-800/30 hover:bg-zinc-800/20",children:[(0,n.jsxs)("td",{className:"pl-4 py-3 text-zinc-100 font-semibold",children:[e.coin,"-PERP"]}),(0,n.jsx)("td",{className:"Long"===e.side?"text-emerald-400":"text-rose-400",children:e.side}),(0,n.jsx)("td",{className:"text-zinc-300",children:e.size}),(0,n.jsx)("td",{className:"text-zinc-400",children:e.leverage}),(0,n.jsx)("td",{className:"text-zinc-300",children:parseFloat(e.entryPx).toLocaleString()}),(0,n.jsx)("td",{className:"text-zinc-300",children:parseFloat(e.markPx).toLocaleString()}),(0,n.jsx)("td",{className:"text-zinc-500",children:e.liquidationPx?parseFloat(e.liquidationPx).toLocaleString():"--"}),(0,n.jsxs)("td",{className:"text-right pr-4 font-semibold ".concat(e.profitable?"text-emerald-400":"text-rose-400"),children:[e.profitable?"+":"",e.unrealizedPnl," ",(0,n.jsxs)("span",{className:"text-zinc-500",children:["(",e.profitable?"+":"",e.returnOnEquity,"%)"]})]})]},e.coin+e.side))})]})),"orders"===s&&(0===c.length?(0,n.jsx)("div",{className:"flex items-center justify-center py-12 text-zinc-600 text-[12px]",children:t?"No open orders":"Connect and select a dWallet to view orders"}):(0,n.jsxs)("table",{className:"w-full text-[11px] font-mono",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-zinc-500 text-left",children:[(0,n.jsx)("th",{className:"pl-4 py-2.5 font-medium",children:"Symbol"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Type"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Side"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Price"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Size"}),(0,n.jsx)("th",{className:"py-2.5 font-medium text-right pr-4",children:"Time"})]})}),(0,n.jsx)("tbody",{children:c.map(e=>(0,n.jsxs)("tr",{className:"border-t border-zinc-800/30 hover:bg-zinc-800/20",children:[(0,n.jsxs)("td",{className:"pl-4 py-3 text-zinc-100 font-semibold",children:[e.coin,"-PERP"]}),(0,n.jsx)("td",{className:"text-zinc-400",children:e.orderType}),(0,n.jsx)("td",{className:"Buy"===e.side?"text-emerald-400":"text-rose-400",children:e.side}),(0,n.jsx)("td",{className:"text-zinc-300",children:parseFloat(e.limitPx).toLocaleString()}),(0,n.jsx)("td",{className:"text-zinc-300",children:e.sz}),(0,n.jsx)("td",{className:"text-zinc-500 text-right pr-4",children:h(e.timestamp)})]},e.oid))})]})),"history"===s&&(0===x.length?(0,n.jsx)("div",{className:"flex items-center justify-center py-12 text-zinc-600 text-[12px]",children:t?"No recent trade history":"Connect and select a dWallet to view history"}):(0,n.jsxs)("table",{className:"w-full text-[11px] font-mono",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"text-zinc-500 text-left",children:[(0,n.jsx)("th",{className:"pl-4 py-2.5 font-medium",children:"Symbol"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Side"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Price"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Size"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Fee"}),(0,n.jsx)("th",{className:"py-2.5 font-medium",children:"Type"}),(0,n.jsx)("th",{className:"py-2.5 font-medium text-right pr-4",children:"Time"})]})}),(0,n.jsx)("tbody",{children:x.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t border-zinc-800/30 hover:bg-zinc-800/20",children:[(0,n.jsxs)("td",{className:"pl-4 py-3 text-zinc-100 font-semibold",children:[e.coin,"-PERP"]}),(0,n.jsx)("td",{className:"Buy"===e.side?"text-emerald-400":"text-rose-400",children:e.side}),(0,n.jsx)("td",{className:"text-zinc-300",children:parseFloat(e.px).toLocaleString()}),(0,n.jsx)("td",{className:"text-zinc-300",children:e.sz}),(0,n.jsx)("td",{className:"text-zinc-500",children:e.fee}),(0,n.jsx)("td",{className:"text-zinc-400",children:e.crossed?"Taker":"Maker"}),(0,n.jsx)("td",{className:"text-zinc-500 text-right pr-4",children:h(e.time)})]},e.hash||t))})]}))]})]})}function eC(){let[e,t]=(0,i.useState)(ey[0]),[s,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)({}),[d,x]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=!1,t=async()=>{try{let t=await ef();e||c(t)}catch(e){}};t();let s=setInterval(t,3e3);return()=>{e=!0,clearInterval(s)}},[]);let m=o[e.symbol.replace("-PERP","")]||null;return(0,n.jsxs)("div",{className:"min-h-screen bg-[#020408] font-[family-name:var(--font-geist-sans)]",children:[(0,n.jsx)("header",{className:"sticky top-0 z-40 bg-[#020408]/80 backdrop-blur-xl border-b border-white/[0.06]",children:(0,n.jsxs)("div",{className:"max-w-[1600px] mx-auto px-6 sm:px-8 h-14 flex items-center gap-4",children:[(0,n.jsx)(a.default,{href:"/",className:"flex items-center gap-2 text-zinc-400 hover:text-zinc-200 transition-colors mr-1",children:(0,n.jsx)(z.Z,{size:16})}),(0,n.jsx)(a.default,{href:"/",className:"text-base font-bold tracking-wider text-zinc-100 mr-2",children:"NEXUS"}),(0,n.jsxs)("div",{className:"flex items-center gap-0.5 bg-zinc-800/50 border border-zinc-700/50 rounded-lg p-1 mr-2",children:[(0,n.jsx)("div",{className:"px-3 py-1.5 text-[12px] font-medium tracking-wide rounded-md bg-zinc-700 text-zinc-100 shadow-sm",children:"Trade"}),(0,n.jsx)(a.default,{href:"/portfolio",className:"px-3 py-1.5 text-[12px] font-medium tracking-wide rounded-md text-zinc-500 hover:text-zinc-300 transition-colors",children:"Portfolio"})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("button",{onClick:()=>l(!s),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800/50 border border-zinc-700/50 rounded-lg hover:border-zinc-600 transition-colors",children:[(0,n.jsx)(w.Z,{size:12,className:"text-zinc-500"}),(0,n.jsx)("span",{className:"text-sm font-semibold text-zinc-100 font-mono",children:e.symbol}),(0,n.jsx)(r.Z,{size:12,className:"text-zinc-500 transition-transform ".concat(s?"rotate-180":"")})]}),s&&(0,n.jsx)("div",{className:"absolute z-50 top-full left-0 mt-2 w-56 bg-zinc-900 border border-zinc-800 rounded-2xl shadow-lg overflow-hidden",children:ey.map(s=>(0,n.jsxs)("button",{onClick:()=>{t(s),l(!1)},className:"w-full flex items-center justify-between px-4 py-2.5 hover:bg-zinc-800/50 transition-colors text-[12px] font-mono ".concat(s.symbol===e.symbol?"bg-indigo-500/[0.06]":""),children:[(0,n.jsx)("span",{className:"text-zinc-100 font-semibold",children:s.symbol}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-zinc-300",children:s.price}),(0,n.jsx)("div",{className:s.positive?"text-emerald-400 text-[10px]":"text-rose-400 text-[10px]",children:s.change})]})]},s.symbol))})]}),(0,n.jsxs)("div",{className:"hidden md:flex items-center gap-6 ml-3",children:[(0,n.jsx)("span",{className:"text-lg font-mono font-bold text-zinc-100",children:m?parseFloat(m).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):e.price}),[{label:"24h Change",value:e.change,color:e.positive?"text-emerald-400":"text-rose-400"},{label:"24h High",value:"43,890.00",color:"text-zinc-300"},{label:"24h Low",value:"42,150.00",color:"text-zinc-300"},{label:"Volume",value:"1.24B",color:"text-zinc-300"},{label:"Funding",value:"0.010%",color:"text-emerald-400"}].map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[10px] text-zinc-500 tracking-wide mb-0.5",children:e.label}),(0,n.jsx)("div",{className:"text-[12px] font-mono font-medium ".concat(e.color),children:e.value})]},e.label))]}),(0,n.jsxs)("div",{className:"ml-auto flex items-center gap-3",children:[(0,n.jsx)(ev,{}),(0,n.jsx)(S.Z,{size:16,className:"text-zinc-500 hover:text-zinc-300 cursor-pointer transition-colors"})]})]})}),(0,n.jsxs)("main",{className:"max-w-[1600px] mx-auto px-6 sm:px-8 py-6 space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,n.jsxs)("div",{className:"flex-1 lg:w-[75%] bg-zinc-900/50 border border-zinc-700/40 rounded-2xl overflow-hidden shadow-lg",children:[(0,n.jsx)("div",{className:"h-[480px] lg:h-[540px]",children:(0,n.jsx)(P,{symbol:e.tv})}),(0,n.jsxs)("div",{className:"border-t border-zinc-800/50",children:[(0,n.jsx)("div",{className:"px-4 py-2.5",children:(0,n.jsx)("span",{className:"text-[12px] text-zinc-400 font-medium",children:"Order Book"})}),(0,n.jsx)(ez,{})]})]}),(0,n.jsx)("div",{className:"lg:w-[25%] min-w-[300px]",children:(0,n.jsxs)("div",{className:"bg-zinc-900/50 border border-zinc-700/40 rounded-2xl p-5 shadow-lg sticky top-20",children:[(0,n.jsx)("h2",{className:"text-[14px] font-semibold text-zinc-200 mb-4",children:"Place Order"}),(0,n.jsx)(ew,{selectedMarket:e,livePrice:m,onEvmAddressChange:e=>x(e||null)})]})})]}),(0,n.jsx)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-2xl overflow-hidden shadow-lg",children:(0,n.jsx)(eS,{evmAddress:d})})]})]})}}}]);