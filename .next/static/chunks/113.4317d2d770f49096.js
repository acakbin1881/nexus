"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{81113:function(e,t,i){i.r(t),i.d(t,{ConnectedWallets:function(){return T},default:function(){return P},useRegistryWallets:function(){return I}});var n=i(57437),s=i(2265),a=i(36826),l=i(91804),r=i(99397),o=i(57586),c=i(82079),d=i(32489),u=i(66337),g=i(10407),x=i(29202),p=i(92451),m=i(51817);function f(e){let{open:t,onClose:i,onConfirm:a,loading:l=!1,externalError:r}=e,[f,b]=(0,s.useState)(1),[h,v]=(0,s.useState)(""),[w,y]=(0,s.useState)(""),[j,N]=(0,s.useState)(null),[z,C]=(0,s.useState)("");function k(){l||(b(1),v(""),y(""),N(null),C(""),i())}async function _(){j&&await a({password:h,chain:j})}let S=r||z;return(0,n.jsx)(o.M,{children:t&&(0,n.jsxs)(c.E.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:k}),(0,n.jsxs)(c.E.div,{className:"relative z-10 w-full max-w-md mx-4 bg-zinc-900 border border-zinc-800 rounded-2xl shadow-2xl overflow-hidden",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-6 pt-6 pb-2",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-zinc-100",children:"Create dWallet"}),(0,n.jsx)("button",{onClick:k,disabled:l,className:"p-1.5 rounded-lg text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800 transition-colors disabled:opacity-40",children:(0,n.jsx)(d.Z,{size:18})})]}),(0,n.jsxs)("div",{className:"flex gap-2 px-6 pb-4",children:[(0,n.jsx)("div",{className:"h-1 flex-1 rounded-full transition-colors ".concat(f>=1?"bg-indigo-500":"bg-zinc-800")}),(0,n.jsx)("div",{className:"h-1 flex-1 rounded-full transition-colors ".concat(f>=2?"bg-indigo-500":"bg-zinc-800")})]}),(0,n.jsx)("div",{className:"px-6 pb-6",children:(0,n.jsxs)(o.M,{mode:"wait",children:[1===f&&(0,n.jsxs)(c.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.15},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)(u.Z,{size:16,className:"text-indigo-400"}),(0,n.jsx)("span",{className:"text-sm text-zinc-400",children:"Set a password for your dWallet"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-[11px] text-zinc-500 uppercase tracking-wide mb-1.5",children:"Password"}),(0,n.jsx)("input",{type:"password",value:h,onChange:e=>{v(e.target.value),C("")},className:"w-full px-3 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-sm text-zinc-100 placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/20 transition-colors",placeholder:"Enter password"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-[11px] text-zinc-500 uppercase tracking-wide mb-1.5",children:"Confirm Password"}),(0,n.jsx)("input",{type:"password",value:w,onChange:e=>{y(e.target.value),C("")},className:"w-full px-3 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-sm text-zinc-100 placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/20 transition-colors",placeholder:"Confirm password"})]}),S&&(0,n.jsx)("p",{className:"text-[12px] text-red-400",children:S})]}),(0,n.jsxs)("button",{onClick:function(){if(!h){C("Password is required");return}if(h!==w){C("Passwords do not match");return}C(""),b(2)},className:"mt-5 w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors",children:["Next",(0,n.jsx)(g.Z,{size:16})]})]},"step-1"),2===f&&(0,n.jsxs)(c.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.15},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,n.jsx)(x.Z,{size:16,className:"text-indigo-400"}),(0,n.jsx)("span",{className:"text-sm text-zinc-400",children:"Select a chain for your dWallet"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("button",{onClick:()=>N("evm"),disabled:l,className:"p-4 rounded-xl border-2 text-left transition-all ".concat("evm"===j?"border-indigo-500 bg-indigo-500/10":"border-zinc-800 bg-zinc-800/50 hover:border-zinc-700"),children:[(0,n.jsx)("div",{className:"text-sm font-semibold text-zinc-100",children:"EVM"}),(0,n.jsx)("div",{className:"text-[11px] text-zinc-500 mt-1",children:"Ethereum & compatible"})]}),(0,n.jsxs)("button",{onClick:()=>N("solana"),disabled:l,className:"p-4 rounded-xl border-2 text-left transition-all ".concat("solana"===j?"border-indigo-500 bg-indigo-500/10":"border-zinc-800 bg-zinc-800/50 hover:border-zinc-700"),children:[(0,n.jsx)("div",{className:"text-sm font-semibold text-zinc-100",children:"Solana VM"}),(0,n.jsx)("div",{className:"text-[11px] text-zinc-500 mt-1",children:"Solana network"})]})]}),S&&(0,n.jsx)("p",{className:"text-[12px] text-red-400 mt-3",children:S}),(0,n.jsxs)("div",{className:"flex gap-3 mt-5",children:[(0,n.jsxs)("button",{onClick:()=>b(1),disabled:l,className:"flex items-center justify-center gap-1 px-4 py-2.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 text-sm font-medium rounded-lg transition-colors disabled:opacity-40",children:[(0,n.jsx)(p.Z,{size:16}),"Back"]}),(0,n.jsx)("button",{onClick:_,disabled:!j||l,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:l?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{size:16,className:"animate-spin"}),"Creating..."]}):"Create dWallet"})]})]},"step-2")]})})]})]})})}var b=i(30401),h=i(78867),v=i(92438),w=i(11239),y=i(53121),j=i(25478);let N={DKGInProgress:{color:"text-yellow-400",bg:"bg-yellow-500/10",label:"DKG In Progress"},AwaitingKeyHolderSignature:{color:"text-amber-400",bg:"bg-amber-500/10",label:"Awaiting Key Holder"},Active:{color:"text-emerald-400",bg:"bg-emerald-500/10",label:"Active"},Frozen:{color:"text-blue-400",bg:"bg-blue-500/10",label:"Frozen"},unknown:{color:"text-zinc-400",bg:"bg-zinc-500/10",label:"Unknown"}};function z(e){var t,i;let{open:a,onClose:r,dWalletAddr:g,label:x,presignIds:p=[],onActivate:f,onCreatePresign:z}=e,[C,k]=(0,s.useState)(!1),[_,S]=(0,s.useState)(""),[E,A]=(0,s.useState)(null),[W,I]=(0,s.useState)(""),[P,D]=(0,s.useState)(!1),[T,K]=(0,s.useState)(""),[Z,O]=(0,s.useState)(""),[F,R]=(0,s.useState)(""),[M,U]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(""),[q,L]=(0,s.useState)(""),[B,J]=(0,s.useState)(null);function G(e,t){navigator.clipboard.writeText(e).then(()=>{J(t),setTimeout(()=>J(null),2e3)})}(0,s.useEffect)(()=>{a||(I(""),D(!1),K(""),O(""),R(""),U(!1),H(""),L(""),J(null))},[a]),(0,s.useEffect)(()=>{if(!a||!g)return;let e=!1;return k(!0),S(""),A(null),(0,j.cA)(g).then(t=>{e||A(t)}).catch(t=>{e||S((null==t?void 0:t.message)||"Failed to fetch dWallet state")}).finally(()=>{e||k(!1)}),()=>{e=!0}},[a,g]);let V=E?null!==(i=N[t=E.state])&&void 0!==i?i:{color:"text-zinc-400",bg:"bg-zinc-500/10",label:t}:null,$=(null==E?void 0:E.state)==="AwaitingKeyHolderSignature",Q=(null==E?void 0:E.state)==="Active";async function X(){if(F&&z){U(!0),L(""),H("Starting presign creation...");try{await z(F),H("Presign created!")}catch(e){L((null==e?void 0:e.message)||"Presign creation failed")}finally{U(!1)}}}async function ee(){if(W&&f){D(!0),O(""),K("Starting activation...");try{await f(W),K("Activated!");try{let e=await (0,j.cA)(g);A(e)}catch(e){}}catch(e){O((null==e?void 0:e.message)||"Activation failed")}finally{D(!1)}}}return(0,n.jsx)(o.M,{children:a&&(0,n.jsxs)(c.E.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:P||M?void 0:r}),(0,n.jsxs)(c.E.div,{className:"relative z-10 w-full max-w-sm mx-4 bg-zinc-900 border border-zinc-800 rounded-2xl shadow-2xl overflow-hidden",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-6 pt-6 pb-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-500/10",children:(0,n.jsx)(l.Z,{size:16,className:"text-indigo-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-sm font-semibold text-zinc-100",children:x}),(0,n.jsxs)("button",{onClick:()=>G(g,"addr"),className:"flex items-center gap-1 group",title:"Copy dWallet address",children:[(0,n.jsx)("span",{className:"text-[10px] font-mono text-zinc-600 group-hover:text-zinc-400 transition-colors",children:g.length>16?"".concat(g.slice(0,8),"...").concat(g.slice(-6)):g}),"addr"===B?(0,n.jsx)(b.Z,{size:10,className:"text-emerald-400"}):(0,n.jsx)(h.Z,{size:10,className:"text-zinc-600 group-hover:text-zinc-400 transition-colors"})]})]})]}),(0,n.jsx)("button",{onClick:r,disabled:P||M,className:"p-1.5 rounded-lg text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800 transition-colors disabled:opacity-40",children:(0,n.jsx)(d.Z,{size:18})})]}),(0,n.jsxs)("div",{className:"px-6 pb-6",children:[C&&(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 py-8",children:[(0,n.jsx)(m.Z,{size:20,className:"animate-spin text-indigo-400"}),(0,n.jsx)("span",{className:"text-sm text-zinc-400",children:"Fetching dWallet state..."})]}),_&&!C&&(0,n.jsx)("div",{className:"py-6",children:(0,n.jsx)("div",{className:"px-4 py-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[12px] text-red-400",children:_})})}),E&&V&&!C&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3.5 rounded-xl border border-zinc-800 ".concat(V.bg),children:[(0,n.jsx)(v.Z,{size:18,className:V.color}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-[11px] text-zinc-500 uppercase tracking-wide",children:"Current State"}),(0,n.jsx)("div",{className:"text-base font-semibold ".concat(V.color),children:V.label})]})]}),(0,n.jsxs)("div",{className:"px-4 py-3 bg-zinc-800/50 rounded-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsx)("div",{className:"text-[11px] text-zinc-500 uppercase tracking-wide",children:"Object ID"}),(0,n.jsx)("button",{onClick:()=>G(E.objectId,"objectId"),className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-zinc-500 hover:text-zinc-300 hover:bg-zinc-700/50 transition-colors",title:"Copy Object ID",children:"objectId"===B?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.Z,{size:10,className:"text-emerald-400"}),(0,n.jsx)("span",{className:"text-[10px] text-emerald-400",children:"Copied"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{size:10}),(0,n.jsx)("span",{className:"text-[10px]",children:"Copy"})]})})]}),(0,n.jsx)("div",{className:"text-[12px] font-mono text-zinc-300 break-all",children:E.objectId})]}),$&&f&&(0,n.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(w.Z,{size:14,className:"text-amber-400"}),(0,n.jsx)("span",{className:"text-sm text-zinc-300",children:"This dWallet needs activation"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-[11px] text-zinc-500 uppercase tracking-wide mb-1.5",children:[(0,n.jsx)(u.Z,{size:10,className:"inline mr-1"}),"dWallet Password"]}),(0,n.jsx)("input",{type:"password",value:W,onChange:e=>{I(e.target.value),O("")},disabled:P,className:"w-full px-3 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-sm text-zinc-100 placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/20 transition-colors disabled:opacity-50",placeholder:"Enter password used during creation"})]}),T&&P&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-zinc-800/50 rounded-lg",children:[(0,n.jsx)(m.Z,{size:14,className:"animate-spin text-amber-400"}),(0,n.jsx)("span",{className:"text-[12px] text-zinc-400",children:T})]}),Z&&(0,n.jsx)("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[12px] text-red-400",children:Z})}),(0,n.jsx)("button",{onClick:ee,disabled:!W||P,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-amber-600 hover:bg-amber-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:P?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{size:16,className:"animate-spin"}),"Activating..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.Z,{size:16}),"Activate dWallet"]})})]}),Q&&(0,n.jsxs)("div",{className:"px-4 py-3 bg-zinc-800/50 rounded-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("div",{className:"text-[11px] text-zinc-500 uppercase tracking-wide",children:"Presign Caps"}),(0,n.jsx)("span",{className:"text-[11px] font-mono text-zinc-400 bg-zinc-700/50 px-2 py-0.5 rounded",children:p.length})]}),0===p.length?(0,n.jsx)("p",{className:"text-[12px] text-zinc-600 italic",children:"No presign caps yet. Create one below to enable signing."}):(0,n.jsx)("div",{className:"space-y-1.5 max-h-[120px] overflow-y-auto",children:p.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2 px-2.5 py-1.5 bg-zinc-900/60 border border-zinc-700/40 rounded-lg",children:[(0,n.jsx)(y.Z,{size:10,className:"text-emerald-400 shrink-0"}),(0,n.jsx)("span",{className:"text-[11px] font-mono text-zinc-400 truncate",children:e.length>20?"".concat(e.slice(0,8),"...").concat(e.slice(-6)):e}),(0,n.jsxs)("span",{className:"text-[9px] text-zinc-600 ml-auto shrink-0",children:["#",t+1]})]},e))})]}),Q&&z&&(0,n.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(y.Z,{size:14,className:"text-emerald-400"}),(0,n.jsx)("span",{className:"text-sm text-zinc-300",children:"Create a Presign"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-[11px] text-zinc-500 uppercase tracking-wide mb-1.5",children:[(0,n.jsx)(u.Z,{size:10,className:"inline mr-1"}),"dWallet Password"]}),(0,n.jsx)("input",{type:"password",value:F,onChange:e=>{R(e.target.value),L("")},disabled:M,className:"w-full px-3 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-sm text-zinc-100 placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/20 transition-colors disabled:opacity-50",placeholder:"Enter password used during creation"})]}),Y&&M&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-zinc-800/50 rounded-lg",children:[(0,n.jsx)(m.Z,{size:14,className:"animate-spin text-emerald-400"}),(0,n.jsx)("span",{className:"text-[12px] text-zinc-400",children:Y})]}),q&&(0,n.jsx)("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,n.jsx)("p",{className:"text-[12px] text-red-400",children:q})}),(0,n.jsx)("button",{onClick:X,disabled:!F||M,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:M?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{size:16,className:"animate-spin"}),"Creating Presign..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Z,{size:16}),"Create Presign"]})})]})]})]})]})]})})}var C=i(92934),k=i(99388),_=i(33245);let S={loading:(0,n.jsx)(m.Z,{size:16,className:"animate-spin text-indigo-400"}),success:(0,n.jsx)(C.Z,{size:16,className:"text-emerald-400"}),error:(0,n.jsx)(k.Z,{size:16,className:"text-red-400"}),info:(0,n.jsx)(_.Z,{size:16,className:"text-zinc-400"})},E={loading:"border-indigo-500/30",success:"border-emerald-500/30",error:"border-red-500/30",info:"border-zinc-700"};function A(e){let{toasts:t,onDismiss:i}=e;return(0,n.jsx)("div",{className:"fixed bottom-6 right-6 z-[60] flex flex-col gap-2 pointer-events-none",children:(0,n.jsx)(o.M,{children:t.map(e=>(0,n.jsx)(W,{toast:e,onDismiss:i},e.id))})})}function W(e){let{toast:t,onDismiss:i}=e;return(0,s.useEffect)(()=>{if("success"===t.type||"info"===t.type){let e=setTimeout(()=>i(t.id),4e3);return()=>clearTimeout(e)}if("error"===t.type){let e=setTimeout(()=>i(t.id),6e3);return()=>clearTimeout(e)}},[t.id,t.type,i]),(0,n.jsxs)(c.E.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},transition:{duration:.2},className:"pointer-events-auto flex items-center gap-3 px-4 py-3 bg-zinc-900/95 backdrop-blur-sm border ".concat(E[t.type]," rounded-xl shadow-lg max-w-sm"),children:[S[t.type],(0,n.jsx)("span",{className:"text-[12px] text-zinc-200",children:t.message})]})}function I(e){let[t,i]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),l=(0,s.useCallback)(async()=>{if(!e){i([]);return}a(!0);try{var t,n,s,l,r,o,c,d,u,g,x,p,m,f,b,h;let a="https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",v=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"sui_getObject",params:["0x0a573f33aab90acaf5bbe39d102de143b2361c774ff1008558f3c5cd1ecb054f",{showContent:!0}]})}),w=await v.json(),y=null===(c=w.result)||void 0===c?void 0:null===(o=c.data)||void 0===o?void 0:null===(r=o.content)||void 0===r?void 0:null===(l=r.fields)||void 0===l?void 0:null===(s=l.wallets)||void 0===s?void 0:null===(n=s.fields)||void 0===n?void 0:null===(t=n.id)||void 0===t?void 0:t.id;if(!y){i([]);return}let j=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:2,method:"suix_getDynamicFieldObject",params:[y,{type:"address",value:e}]})}),N=await j.json(),z=null===(x=N.result)||void 0===x?void 0:null===(g=x.data)||void 0===g?void 0:null===(u=g.content)||void 0===u?void 0:null===(d=u.fields)||void 0===d?void 0:d.value;if(Array.isArray(z)){let e=z.map(e=>{var t,i;return{dwallet_addr:e.fields.dwallet_addr,session_id:null!==(t=e.fields.session_id)&&void 0!==t?t:[],user_public_output:null!==(i=e.fields.user_public_output)&&void 0!==i?i:[],label:e.fields.label,chain:e.fields.chain,presign_ids:Array.isArray(e.fields.presign_ids)?e.fields.presign_ids:[]}}),t=e.flatMap(e=>e.presign_ids);console.log("[PresignDebug] Cap object IDs from registry:",t);let n=new Map;if(t.length>0){let e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>({jsonrpc:"2.0",id:t+100,method:"sui_getObject",params:[e,{showContent:!0}]})))}),i=await e.json();for(let e of Array.isArray(i)?i:[i]){let t=null==e?void 0:null===(f=e.result)||void 0===f?void 0:null===(m=f.data)||void 0===m?void 0:null===(p=m.content)||void 0===p?void 0:p.fields,i=null==e?void 0:null===(h=e.result)||void 0===h?void 0:null===(b=h.data)||void 0===b?void 0:b.objectId;console.log("[PresignDebug] getObject response for",i,"→ fields:",JSON.stringify(t,null,2)),(null==t?void 0:t.presign_id)&&i&&(console.log("[PresignDebug] Resolved capId:",i,"→ presign_id:",t.presign_id),n.set(i,t.presign_id))}}console.log("[PresignDebug] Full resolved map:",Object.fromEntries(n));let s=e.map(e=>({...e,presign_ids:e.presign_ids.map(e=>n.get(e)).filter(Boolean)}));console.log("[PresignDebug] Final wallet presign_ids:",s.map(e=>({label:e.label,presign_ids:e.presign_ids}))),i(s)}else i([])}catch(e){console.error("Failed to fetch registry wallets:",e),i([])}finally{a(!1)}},[e]);return(0,s.useEffect)(()=>{l()},[l]),{wallets:t,loading:n,refetch:l}}function P(){let e=(0,a.useCurrentAccount)(),{dWalletCount:t,loading:i}=function(e){let t=(0,a.useCurrentClient)(),[i,n]=(0,s.useState)(0),[l,r]=(0,s.useState)(!1),o=(0,s.useCallback)(async()=>{if(e&&t){r(!0);try{let i=await t.listOwnedObjects({owner:e,type:"0xf02f5960c94fce1899a3795b5d11fd076bc70a8d0e20a2b19923d990ed490730::coordinator_inner::DWalletCap",limit:1e3});n(i.objects.length)}catch(e){console.error("Failed to fetch dWallets:",e)}finally{r(!1)}}},[e,t]);return(0,s.useEffect)(()=>{o()},[o]),{dWalletCount:i,loading:l}}(null==e?void 0:e.address);return e?(0,n.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-2xl p-6 shadow-lg",children:[(0,n.jsx)("div",{className:"text-[12px] text-zinc-400 font-medium uppercase tracking-wide mb-4",children:"dWallets"}),i?(0,n.jsx)("div",{className:"text-[12px] text-zinc-500",children:"Loading..."}):(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-indigo-500/10 border border-indigo-500/20",children:(0,n.jsx)(l.Z,{size:24,className:"text-indigo-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-3xl font-mono font-bold text-zinc-100",children:t}),(0,n.jsx)("div",{className:"text-[11px] text-zinc-500",children:"dWallet objects held"})]})]})]}):null}let D=0;function T(){var e,t,i;let o=(0,a.useCurrentAccount)(),c=(0,a.useCurrentClient)(),d=(0,a.useDAppKit)(),{wallets:u,loading:g,refetch:x}=I(null==o?void 0:o.address),[p,m]=(0,s.useState)(!1),[b,h]=(0,s.useState)(!1),[v,w]=(0,s.useState)(""),[y,N]=(0,s.useState)([]),[C,k]=(0,s.useState)(null),_=(0,s.useRef)(!1),S=(0,s.useRef)(u.length);function E(e,t,i){N(n=>n.map(n=>n.id===e?{...n,message:t,type:i}:n))}if((0,s.useEffect)(()=>{if(_.current&&u.length>S.current){_.current=!1;let e=u[u.length-1];e&&k({addr:e.dwallet_addr,label:e.label,chain:e.chain,user_public_output:e.user_public_output,presign_ids:e.presign_ids})}S.current=u.length},[u]),!o||g)return null;async function W(e){if(!o||!c)return;h(!0),w("");let t=function(e,t){let i="toast-".concat(++D);return N(n=>[...n,{id:i,message:e,type:t}]),i}("Starting dWallet creation...","loading");try{let i=await (0,j.Zg)({password:e.password,chain:e.chain,suiClient:c,senderAddress:o.address,signAndExecuteTransaction:e=>d.signAndExecuteTransaction({transaction:e.transaction}),onStatus:e=>E(t,e,"loading")});E(t,"dWallet created! Tx: ".concat(i.transactionDigest.slice(0,10),"... Opening wallet for activation..."),"success"),m(!1),_.current=!0,await x()}catch(i){console.error("Failed to create dWallet:",i);let e=(null==i?void 0:i.message)||"Failed to create dWallet";E(t,e,"error"),w(e)}finally{h(!1)}}let P=u.filter(e=>"evm"===e.chain.toLowerCase());return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[P.map(e=>{var t;return(0,n.jsxs)("button",{onClick:()=>k({addr:e.dwallet_addr,label:e.label,chain:e.chain,user_public_output:e.user_public_output,presign_ids:e.presign_ids}),className:"flex items-center gap-2 px-3 py-2 bg-zinc-800/60 border border-zinc-700/50 rounded-lg hover:bg-zinc-800 hover:border-zinc-600 transition-colors cursor-pointer",children:[(0,n.jsx)(l.Z,{size:12,className:"text-zinc-500"}),(0,n.jsxs)("div",{className:"text-left",children:[(0,n.jsx)("div",{className:"text-[11px] text-zinc-300 font-medium",children:e.label}),(0,n.jsx)("div",{className:"text-[10px] font-mono text-zinc-600",children:(t=e.dwallet_addr).length<=12?t:"".concat(t.slice(0,6),"...").concat(t.slice(-4))})]}),(0,n.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-emerald-400 ml-1"})]},e.dwallet_addr)}),(0,n.jsxs)("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-dashed border-indigo-500/40 text-indigo-400 hover:bg-indigo-500/10 hover:border-indigo-500/60 transition-all",children:[(0,n.jsx)(r.Z,{size:14}),(0,n.jsx)("span",{className:"text-[11px] font-medium tracking-wide",children:"Add dWallet"})]}),(0,n.jsx)(f,{open:p,onClose:()=>{m(!1),w("")},onConfirm:W,loading:b,externalError:v}),(0,n.jsx)(A,{toasts:y,onDismiss:function(e){N(t=>t.filter(t=>t.id!==e))}}),(0,n.jsx)(z,{open:!!C,onClose:()=>k(null),dWalletAddr:null!==(e=null==C?void 0:C.addr)&&void 0!==e?e:"",label:null!==(t=null==C?void 0:C.label)&&void 0!==t?t:"",presignIds:null!==(i=null==C?void 0:C.presign_ids)&&void 0!==i?i:[],onActivate:async e=>{if(!o||!C)return;let t=new Uint8Array(C.user_public_output),i="evm"===C.chain.toLowerCase()?"evm":"solana";await (0,j.wh)({password:e,chain:i,dWalletObjectId:C.addr,userPublicOutput:t,senderAddress:o.address,signAndExecuteTransaction:e=>d.signAndExecuteTransaction({transaction:e.transaction})})},onCreatePresign:async e=>{if(!o||!C)return;let t="evm"===C.chain.toLowerCase()?"evm":"solana";await (0,j.Cx)({password:e,chain:t,dwalletAddr:C.addr,senderAddress:o.address,signAndExecuteTransaction:e=>d.signAndExecuteTransaction({transaction:e.transaction})})}})]})}},25478:function(e,t,i){i.d(t,{Cx:function(){return N},Zg:function(){return y},cA:function(){return w},uQ:function(){return z},wh:function(){return j}});var n=i(83343),s=i(97895),a=i(56536),l=i(91502),r=i(50491),o=i(87807),c=i(1314),d=i(47769),u=i(42021),g=i(13439);let x=new TextEncoder().encode("NEXUS_DWALLET_SALT_V1_2026_02_07"),p="0x1f26bb2f711ff82dcda4d02c77d5123089cb7f8418751474b9fb744ce031526a::ika::IKA";function m(e){return new Promise(t=>setTimeout(t,e))}async function f(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let r=0;r<i;r++)try{return await e()}catch(e){var s,a,l;if(t=e,(null==e?void 0:null===(s=e.cause)||void 0===s?void 0:s.status)===429||(null==e?void 0:e.status)===429||(null==e?void 0:null===(a=e.cause)||void 0===a?void 0:a.code)===-32010||(null==e?void 0:null===(l=e.message)||void 0===l?void 0:l.includes("Too many requests"))){let e=n*Math.pow(2,r);console.log("Rate limit hit. Retrying in ".concat(e,"ms... (attempt ").concat(r+1,"/").concat(i,")")),await m(e)}else throw e}throw t}async function b(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:18e4,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4e3,a=Date.now()+n;for(;Date.now()<a;)try{return await e.getPresignInParticularState(i,"Completed",{timeout:5e3,interval:2e3})}catch(t){let e=(null==t?void 0:t.message)||"";if(e.includes("Unknown value")||e.includes("enum")||e.includes("Timeout")){try{var l,r,o;let e=await fetch("https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"sui_getObject",params:[i,{showContent:!0}]})}),t=await e.json(),n=null==t?void 0:null===(r=t.result)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.content;if(null==n?void 0:null===(o=n.fields)||void 0===o?void 0:o.state){let e=n.fields.state.fields,i=n.fields.state.type;if((null==i?void 0:i.includes("Completed"))||(null==e?void 0:e.Completed))return t.result.data}}catch(e){}await m(s);continue}throw t}throw Error("Timeout waiting for presign ".concat(i," to reach Completed state after ").concat(n,"ms"))}async function h(e){let t=new TextEncoder().encode(e),i=new Uint8Array(x.length+t.length);return i.set(x,0),i.set(t,x.length),new Uint8Array(await crypto.subtle.digest("SHA-256",i))}function v(e){return"evm"===e?n.Hy.SECP256K1:n.Hy.ED25519}async function w(e){var t;let i=new u.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"}),n=new s.W({suiClient:i,config:(0,a.M)("testnet")});await f(()=>n.initialize());let l=await f(()=>n.getDWallet(e));return{objectId:e,state:(null==l?void 0:null===(t=l.state)||void 0===t?void 0:t.$kind)||"unknown"}}async function y(e){var t,i,n;let{password:c,chain:d,suiClient:x,senderAddress:m,signAndExecuteTransaction:b,onStatus:w}=e,y=null!=w?w:()=>{},j=new u.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"}),N=v(d);y("Deriving encryption keys from password...");let z=await h(c),C=await l.e.fromRootSeedKey(z,N);y("Connecting to Ika network...");let k=new s.W({suiClient:j,config:(0,a.M)("testnet")});await f(()=>k.initialize()),y("Building transaction...");let _=new g.Y,S=new r.w({ikaClient:k,transaction:_,userShareEncryptionKeys:C});y("Checking wallet balances...");let E=await f(()=>j.getAllCoins({owner:m})),A=E.data.filter(e=>e.coinType===p),W=E.data.filter(e=>"0x2::sui::SUI"===e.coinType);if(!A[0])throw Error("No IKA coins found. You need IKA tokens to create a dWallet.");if(!W[0])throw Error("Insufficient SUI coins. You need at least 2 SUI coin objects for gas.");let I=_.object(A[0].coinObjectId);_.object(W[0].coinObjectId),y("Registering encryption key on-chain...");let P=(0,o.ow)();await S.registerEncryptionKey({curve:N}),y("Fetching network encryption key...");let D=await f(()=>k.getLatestNetworkEncryptionKey());y("Preparing distributed key generation (DKG)...");let T=await f(()=>(0,o.xj)(k,N,C,P,m)),K=Array.from(new Uint8Array(T.userPublicOutput)),Z=_.splitCoins(_.gas,[1e8]);y("Requesting dWallet key generation...");let[O]=await S.requestDWalletDKG({dkgRequestInput:T,sessionIdentifier:S.registerSessionIdentifier(P),dwalletNetworkEncryptionKeyId:D.id,curve:N,ikaCoin:I,suiCoin:Z});_.transferObjects([Z],m);let F=Array.from(P).map(e=>BigInt(e));_.moveCall({target:"".concat("0x74488c74f58127300e8e69f0bd851afa23963f9134ab6d59a33554f9145dcf5c","::nexus_wallet_management::register_dwallet"),arguments:[_.object("0x0a573f33aab90acaf5bbe39d102de143b2361c774ff1008558f3c5cd1ecb054f"),_.pure.string("EVM"),_.pure.string("EVM"),O,_.pure.vector("u64",F),_.pure.vector("u8",K)]}),_.transferObjects([O],m),_.setSender(m),y("Waiting for wallet signature...");let R=await b({transaction:_}),M=null!==(n=null!==(i=null==R?void 0:R.digest)&&void 0!==i?i:null==R?void 0:null===(t=R.Transaction)||void 0===t?void 0:t.digest)&&void 0!==n?n:"unknown";return y("dWallet created successfully!"),{transactionDigest:M,sessionId:P}}async function j(e){var t,i,n,o,c,d,x;let{password:p,chain:m,dWalletObjectId:b,userPublicOutput:w,senderAddress:y,signAndExecuteTransaction:j,onStatus:N}=e,z=null!=N?N:()=>{},C=new u.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"}),k=v(m);z("Deriving encryption keys...");let _=await h(p),S=await l.e.fromRootSeedKey(_,k);z("Connecting to Ika network...");let E=new s.W({suiClient:C,config:(0,a.M)("testnet")});await f(()=>E.initialize()),z("Checking dWallet state...");let A=await f(()=>E.getDWallet(b)),W=(null==A?void 0:null===(t=A.state)||void 0===t?void 0:t.$kind)||"unknown";if("Active"===W)return z("dWallet is already active!"),{transactionDigest:"already-active"};"AwaitingKeyHolderSignature"!==W&&(z("Waiting for AwaitingKeyHolderSignature state (current: ".concat(W,")...")),await E.getDWalletInParticularState(b,"AwaitingKeyHolderSignature",{timeout:3e5,interval:5e3}));let I=await f(()=>E.getDWallet(b));z("Building activation transaction...");let P=new g.Y,D=new r.w({ikaClient:E,transaction:P,userShareEncryptionKeys:S}),T=null===(n=I.encrypted_user_secret_key_shares)||void 0===n?void 0:null===(i=n.id)||void 0===i?void 0:i.id;if(!T)throw Error("encrypted_user_secret_key_shares table not found on dWallet");let K=await C.getDynamicFields({parentId:T});if(!K.data||0===K.data.length)throw Error("No encrypted user secret key shares found. The network may not have completed DKG yet.");let Z=null===(o=K.data[0])||void 0===o?void 0:o.objectId;if(!Z)throw Error("encryptedUserSecretKeyShareId not found");z("Accepting encrypted user share..."),await D.acceptEncryptedUserShare({dWallet:I,encryptedUserSecretKeyShareId:Z,userPublicOutput:w}),P.setSender(y),z("Waiting for wallet signature...");let O=await j({transaction:P}),F=null!==(x=null!==(d=null==O?void 0:O.digest)&&void 0!==d?d:null==O?void 0:null===(c=O.Transaction)||void 0===c?void 0:c.digest)&&void 0!==x?x:"unknown";z("Waiting for dWallet to become active...");try{await E.getDWalletInParticularState(b,"Active",{timeout:12e4,interval:3e3}),z("dWallet activated successfully!")}catch(e){z("Activation submitted. dWallet may still be processing.")}return{transactionDigest:F}}async function N(e){var t,i,o,x;let{password:m,chain:w,dwalletAddr:y,senderAddress:j,signAndExecuteTransaction:N,onStatus:z}=e,C=null!=z?z:()=>{},k=new u.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"}),_=v(w);C("Deriving encryption keys...");let S=await h(m),E=await l.e.fromRootSeedKey(S,_);C("Connecting to Ika network...");let A=new s.W({suiClient:k,config:(0,a.M)("testnet")});await f(()=>A.initialize()),C("Building presign transaction...");let W=new g.Y,I=new r.w({ikaClient:A,transaction:W,userShareEncryptionKeys:E});C("Checking wallet balances...");let P=(await f(()=>k.getAllCoins({owner:j}))).data.filter(e=>e.coinType===p);if(!P[0])throw Error("No IKA coins found. You need IKA tokens to create a presign.");let D=W.object(P[0].coinObjectId);C("Fetching network encryption key...");let T=await f(()=>A.getLatestNetworkEncryptionKey()),K=W.splitCoins(W.gas,[1e8]);C("Requesting presign...");let Z=I.requestGlobalPresign({curve:_,signatureAlgorithm:"evm"===w?n.Ye.ECDSASecp256k1:n.Ye.EdDSA,ikaCoin:D,suiCoin:K,dwalletNetworkEncryptionKeyId:T.id});W.transferObjects([K],j),W.moveCall({target:"".concat("0x74488c74f58127300e8e69f0bd851afa23963f9134ab6d59a33554f9145dcf5c","::nexus_wallet_management::add_presign_id"),arguments:[W.object("0x0a573f33aab90acaf5bbe39d102de143b2361c774ff1008558f3c5cd1ecb054f"),W.pure.address(y),Z]}),W.transferObjects([Z],j),W.setSender(j),C("Waiting for wallet signature...");let O=await N({transaction:W}),F=null!==(x=null!==(o=null==O?void 0:O.digest)&&void 0!==o?o:null==O?void 0:null===(t=O.Transaction)||void 0===t?void 0:t.digest)&&void 0!==x?x:"unknown";C("Waiting for transaction confirmation...");let R=null===(i=(await f(()=>k.waitForTransaction({digest:F,options:{showEvents:!0}}))).events)||void 0===i?void 0:i.find(e=>e.type.includes("PresignRequestEvent"));if(!R)throw Error("PresignRequestEvent not found in transaction events");let M=c.nh(d.uK).fromBase64(R.bcs).event_data.presign_id;C("Waiting for presign to complete (MPC computation)...");try{await b(A,k,M,18e4,4e3),C("Presign created successfully!")}catch(e){C("Presign submitted. It may still be processing.")}return{transactionDigest:F,presignId:M}}async function z(e){var t,i,o,c,d,x,m,v,w,y;let j,{password:N,dWalletObjectId:z,userPublicOutput:C,presignId:k,presignIds:_,unsignedBytes:S,senderAddress:E,signAndExecuteTransaction:A,onStatus:W}=e,I=null!=W?W:()=>{},P=(null==_?void 0:_.length)?[..._]:k?[k]:[];if(0===P.length)throw Error("No presign IDs provided. Create presigns from the Portfolio page.");let D=new u.R({url:"https://api.us1.shinami.com/sui/node/v1/us1_sui_testnet_b909eacf46e54e799a307be45791e726",network:"testnet"});I("Deriving encryption keys...");let T=await h(N),K=await l.e.fromRootSeedKey(T,n.Hy.SECP256K1);I("Connecting to Ika network...");let Z=new s.W({suiClient:D,config:(0,a.M)("testnet")});await f(()=>Z.initialize()),I("Fetching dWallet...");let O=await f(()=>Z.getDWalletInParticularState(z,"Active",{timeout:3e4,interval:3e3})),F=null,R=P[0];for(let e=0;e<P.length;e++){let t=P[e];I("Fetching presign (".concat(e+1,"/").concat(P.length,")..."));try{F=await b(Z,D,t,6e4,4e3),R=t;break}catch(i){let e=(null==i?void 0:i.message)||"";if(e.includes("Timeout")||e.includes("timeout")){I("Presign ".concat(t.slice(0,8),"... timed out, trying next..."));continue}throw i}}if(!F)throw Error("All ".concat(P.length," presign cap(s) timed out. Create new presigns from the Portfolio page."));I("Checking balances...");let M=await f(()=>D.getAllCoins({owner:E})),U=M.data.filter(e=>e.coinType===p),Y=M.data.filter(e=>"0x2::sui::SUI"===e.coinType);if(!U[0])throw Error("No IKA coins found. You need IKA tokens to sign.");if(!Y[0])throw Error("No SUI coins found for gas.");I("Fetching encrypted shares...");let H=null===(i=O.encrypted_user_secret_key_shares)||void 0===i?void 0:null===(t=i.id)||void 0===t?void 0:t.id;if(!H)throw Error("encrypted_user_secret_key_shares not found on dWallet");let q=await f(()=>D.getDynamicFields({parentId:H}));if(!(null===(o=q.data)||void 0===o?void 0:o.length))throw Error("No encrypted user secret key shares found");let L=null===(c=q.data[0])||void 0===c?void 0:c.objectId;if(!L)throw Error("Encrypted share object ID not found");let B=await f(()=>Z.getEncryptedUserSecretKeyShare(L));I("Building sign request...");let J=new g.Y,G=new r.w({ikaClient:Z,transaction:J,userShareEncryptionKeys:K}),V=J.object(U[0].coinObjectId),$=J.splitCoins(J.gas,[1e8]),Q=G.approveMessage({message:S,curve:n.Hy.SECP256K1,dWalletCap:O.dwallet_cap_id,signatureAlgorithm:n.Ye.ECDSASecp256k1,hashScheme:n.kb.KECCAK256}),X=await f(async()=>G.verifyPresignCap({presign:F})),ee=null===(x=O.state)||void 0===x?void 0:null===(d=x.Active)||void 0===d?void 0:d.public_output;if(!ee)throw Error("dWallet missing public_output in Active state");let et=ee instanceof Uint8Array?ee:new Uint8Array(ee);await G.requestSign({dWallet:O,messageApproval:Q,hashScheme:n.kb.KECCAK256,verifiedPresignCap:X,presign:F,message:S,signatureScheme:n.Ye.ECDSASecp256k1,ikaCoin:V,suiCoin:$,publicOutput:et,encryptedUserSecretKeyShare:B}),J.transferObjects([$],E),J.setSender(E),I("Waiting for wallet signature...");let ei=await A({transaction:J}),en=null!==(w=null!==(v=null==ei?void 0:ei.digest)&&void 0!==v?v:null==ei?void 0:null===(m=ei.Transaction)||void 0===m?void 0:m.digest)&&void 0!==w?w:"unknown";I("Waiting for transaction confirmation...");let es=await f(()=>D.waitForTransaction({digest:en,options:{showEvents:!0,showObjectChanges:!0,showEffects:!0}}));if(es.events){let e=es.events.find(e=>{var t;return null===(t=e.type)||void 0===t?void 0:t.includes("SignRequestEvent")});(null==e?void 0:null===(y=e.parsedJson)||void 0===y?void 0:y.sign_id)&&(j=e.parsedJson.sign_id)}if(!j&&es.objectChanges){let e=es.objectChanges.find(e=>{var t;return"created"===e.type&&(null===(t=e.objectType)||void 0===t?void 0:t.includes("SignSession"))});(null==e?void 0:e.objectId)&&(j=e.objectId)}if(!j)throw Error("Sign object ID not found in transaction results");I("Waiting for MPC signature computation...");let ea=await Z.getSignInParticularState(j,n.Hy.SECP256K1,n.Ye.ECDSASecp256k1,"Completed");I("Signature received!");let el=Uint8Array.from(ea.state.Completed.signature);return el.usedPresignId=R,el}}}]);